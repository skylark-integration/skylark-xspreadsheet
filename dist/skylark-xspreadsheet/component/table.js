/**
 * skylark-xspreadsheet - A version of xspreadsheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../core/alphabet","../core/font","../core/cell","../core/formula","../core/format","../canvas/draw"],function(e,t,i,l,r,s){"use strict";const a=5,n={fillStyle:"#f4f5f8"},o={fillStyle:"#fff",lineWidth:s.thinLineWidth,strokeStyle:"#e6e6e6"};function c(e,t,i,l=0){const{left:r,top:n,width:o,height:c}=e.cellRect(t,i);return new s.DrawBox(r,n+l,o,c,a)}function h(e,s,a,n,o=0){const{sortedRowMap:h,rows:f,cols:d}=s;if(f.isHide(a)||d.isHide(n))return;let w=a;h.has(a)&&(w=h.get(a));const g=s.getCell(w,n);if(null===g)return;let u=!1;"editable"in g&&!1===g.editable&&(u=!0);const v=s.getCellStyleOrDefault(w,n),x=c(s,a,n,o);x.bgcolor=v.bgcolor,void 0!==v.border&&(x.setBorders(v.border),e.strokeBorders(x)),e.rect(x,()=>{let o=i.render(g.text||"",l.formulam,(e,t)=>s.getCellTextOrDefault(t,e));v.format&&(o=r.formatm[v.format].render(o));const c=Object.assign({},v.font);c.size=t.getFontSizePxByPt(c.size),e.text(o,x,{align:v.align,valign:v.valign,font:c,color:v.color,strike:v.strike,underline:v.underline},v.textwrap),s.validations.getError(a,n)&&e.error(x),u&&e.frozen(x)})}function f(e,t,i,l,r){const{draw:s,data:a}=this;s.save(),s.translate(t,i).translate(l,r);const{exceptRowSet:n}=a,o=a.exceptRowTotalHeight(e.sri,e.eri);s.save(),s.translate(0,-o),e.each((e,t)=>{h(s,a,e,t)},e=>(e=>{const t=n.has(e);if(t){const t=a.rows.getHeight(e);s.translate(0,-t)}return!t})(e)),s.restore();const f=new Set;s.save(),s.translate(0,-o),a.eachMergesInView(e,({sri:e,sci:t,eri:i})=>{if(n.has(e)){if(!f.has(e)){f.add(e);const t=a.rows.sumHeight(e,i+1);s.translate(0,-t)}}else h(s,a,e,t)}),s.restore(),function(e){const{data:t,draw:i}=this;if(e){const{autoFilter:l}=t;if(!l.active())return;const r=l.hrange();e.intersects(r)&&r.each((e,l)=>{const r=c(t,e,l);i.dropdown(r)})}}.call(this,e),s.restore()}function d(e,t,i,l){const{draw:r}=this;r.save(),r.attr({fillStyle:"rgba(75, 137, 255, 0.08)"}).fillRect(e,t,i,l),r.restore()}function w(t,i,l,r,a,o){const{draw:c,data:h}=this,f=i.h,w=i.w,g=o+r,u=a+l;c.save(),c.attr(n),"all"!==t&&"left"!==t||c.fillRect(0,g,l,f),"all"!==t&&"top"!==t||c.fillRect(u,0,w,r);const{sri:v,sci:x,eri:S,eci:y}=h.selector.range;c.attr({textAlign:"center",textBaseline:"middle",font:`500 ${s.npx(12)}px Source Sans Pro`,fillStyle:"#585757",lineWidth:s.thinLineWidth(),strokeStyle:"#e6e6e6"}),"all"!==t&&"left"!==t||(h.rowEach(i.sri,i.eri,(e,t,i)=>{const r=g+t,s=e;c.line([0,r],[l,r]),v<=s&&s<S+1&&d.call(this,0,r,l,i),c.fillText(s+1,l/2,r+i/2),e>0&&h.rows.isHide(e-1)&&(c.save(),c.attr({strokeStyle:"#c6c6c6"}),c.line([5,r+5],[l-5,r+5]),c.restore())}),c.line([0,f+g],[l,f+g]),c.line([l,g],[l,f+g])),"all"!==t&&"top"!==t||(h.colEach(i.sci,i.eci,(t,i,l)=>{const s=u+i,a=t;c.line([s,0],[s,r]),x<=a&&a<y+1&&d.call(this,s,0,l,r),c.fillText(e.stringAt(a),s+l/2,r/2),t>0&&h.cols.isHide(t-1)&&(c.save(),c.attr({strokeStyle:"#c6c6c6"}),c.line([s+5,5],[s+5,r-5]),c.restore())}),c.line([w+u,0],[w+u,r]),c.line([0,r],[w+u,r])),c.restore()}function g({sri:e,sci:t,eri:i,eci:l,w:r,h:s},a,n,c,h){const{draw:f,data:d}=this,{settings:w}=d;f.save(),f.attr(o).translate(a+c,n+h),f.clearRect(0,0,r,s),w.showGrid?(d.rowEach(e,i,(t,l,s)=>{t!==e&&f.line([0,l],[r,l]),t===i&&f.line([0,l+s],[r,l+s])}),d.colEach(t,l,(e,i,r)=>{e!==t&&f.line([i,0],[i,s]),e===l&&f.line([i+r,0],[i+r,s])}),f.restore()):f.restore()}return{renderCell:h,Table:class{constructor(e,t){this.el=e,this.draw=new s.Draw(e,t.viewWidth(),t.viewHeight()),this.data=t}resetData(e){this.data=e,this.render()}render(){const{data:e}=this,{rows:t,cols:i}=e,l=i.indexWidth,r=t.height;this.draw.resize(e.viewWidth(),e.viewHeight()),this.clear();const s=e.viewRange(),a=e.freezeTotalWidth(),n=e.freezeTotalHeight(),{x:o,y:c}=e.scroll;g.call(this,s,l,r,a,n),f.call(this,s,l,r,-o,-c),w.call(this,"all",s,l,r,a,n),function(e,t){const{draw:i}=this;i.save(),i.attr({fillStyle:"#f4f5f8"}).fillRect(0,0,e,t),i.restore()}.call(this,l,r);const[h,d]=e.freeze;if(h>0||d>0){if(h>0){const e=s.clone();e.sri=0,e.eri=h-1,e.h=n,g.call(this,e,l,r,a,0),f.call(this,e,l,r,-o,0),w.call(this,"top",e,l,r,a,0)}if(d>0){const e=s.clone();e.sci=0,e.eci=d-1,e.w=a,g.call(this,e,l,r,0,n),w.call(this,"left",e,l,r,0,n),f.call(this,e,l,r,0,-c)}const t=e.freezeViewRange();g.call(this,t,l,r,0,0),w.call(this,"all",t,l,r,0,0),f.call(this,t,l,r,0,0),function(e,t,i,l){const{draw:r,data:s}=this,a=s.viewWidth()-e,n=s.viewHeight()-t;r.save().translate(e,t).attr({strokeStyle:"rgba(75, 137, 255, .6)"}),r.line([0,l],[a,l]),r.line([i,0],[i,n]),r.restore()}.call(this,l,r,a,n)}}clear(){this.draw.clear()}}}});
//# sourceMappingURL=../sourcemaps/component/table.js.map
