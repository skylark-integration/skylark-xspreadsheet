/**
 * skylark-xspreadsheet - A version of xspreadsheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./element","../config","../core/cell_range"],function(t,e,i){"use strict";const s=3;let h=10;class l{constructor(i=!1){this.useHideInput=i,this.inputChange=(()=>{}),this.cornerEl=t.h("div",`${e.cssPrefix}-selector-corner`),this.areaEl=t.h("div",`${e.cssPrefix}-selector-area`).child(this.cornerEl).hide(),this.clipboardEl=t.h("div",`${e.cssPrefix}-selector-clipboard`).hide(),this.autofillEl=t.h("div",`${e.cssPrefix}-selector-autofill`).hide(),this.el=t.h("div",`${e.cssPrefix}-selector`).css("z-index",`${h}`).children(this.areaEl,this.clipboardEl,this.autofillEl).hide(),i&&(this.hideInput=t.h("input","").on("compositionend",t=>{this.inputChange(t.target.value)}),this.el.child(this.hideInputDiv=t.h("div","hide-input").child(this.hideInput)),this.el.child(this.hideInputDiv=t.h("div","hide-input").child(this.hideInput))),h+=1}setOffset(t){return this.el.offset(t).show(),this}hide(){return this.el.hide(),this}setAreaOffset(t){const{left:e,top:i,width:h,height:l}=t,a={width:h-s+.8,height:l-s+.8,left:e-.8,top:i-.8};this.areaEl.offset(a).show(),this.useHideInput&&(this.hideInputDiv.offset(a),this.hideInput.val("").focus())}setClipboardOffset(t){const{left:e,top:i,width:s,height:h}=t;this.clipboardEl.offset({left:e,top:i,width:s-5,height:h-5})}showAutofill(t){const{left:e,top:i,width:h,height:l}=t;this.autofillEl.offset({width:h-s,height:l-s,left:e,top:i}).show()}hideAutofill(){this.autofillEl.hide()}showClipboard(){this.clipboardEl.show()}hideClipboard(){this.clipboardEl.hide()}}function a(t){const{data:e}=this,{left:i,top:s,width:h,height:l,scroll:a,l:o,t:c}=t,n=e.freezeTotalWidth(),r=e.freezeTotalHeight();let f=i-n;n>o&&(f-=a.x);let d=s-r;return r>c&&(d-=a.y),{left:f,top:d,width:h,height:l}}function o(t){const{data:e}=this,{left:i,width:s,height:h,l:l,t:a,scroll:o}=t,c=e.freezeTotalWidth();let n=i-c;return c>l&&(n-=o.x),{left:n,top:a,width:s,height:h}}function c(t){const{data:e}=this,{top:i,width:s,height:h,l:l,t:a,scroll:o}=t,c=e.freezeTotalHeight();let n=i-c;return c>a&&(n-=o.y),{left:l,top:n,width:s,height:h}}function n(t){const{br:e}=this;e.setAreaOffset(a.call(this,t))}function r(t){const{t:e}=this;e.setAreaOffset(o.call(this,t))}function f(t){const{l:e}=this;e.setAreaOffset(c.call(this,t))}function d(t){const{l:e}=this;e.setClipboardOffset(c.call(this,t))}function u(t){const{br:e}=this;e.setClipboardOffset(a.call(this,t))}function g(t){const{t:e}=this;e.setClipboardOffset(o.call(this,t))}function p(t){n.call(this,t),function(t){const{tl:e}=this;e.setAreaOffset(t)}.call(this,t),r.call(this,t),f.call(this,t)}function w(t){u.call(this,t),function(t){const{tl:e}=this;e.setClipboardOffset(t)}.call(this,t),g.call(this,t),d.call(this,t)}return class{constructor(i){this.inputChange=(()=>{}),this.data=i,this.br=new l(!0),this.t=new l,this.l=new l,this.tl=new l,this.br.inputChange=(t=>{this.inputChange(t)}),this.br.el.show(),this.offset=null,this.areaOffset=null,this.indexes=null,this.range=null,this.arange=null,this.el=t.h("div",`${e.cssPrefix}-selectors`).children(this.tl.el,this.t.el,this.l.el,this.br.el).hide(),this.lastri=-1,this.lastci=-1,h+=1}resetData(t){this.data=t,this.range=t.selector.range,this.resetAreaOffset()}hide(){this.el.hide()}resetOffset(){const{data:t,tl:e,t:i,l:s,br:h}=this,l=t.freezeTotalHeight(),a=t.freezeTotalWidth();l>0||a>0?(e.setOffset({width:a,height:l}),i.setOffset({left:a,height:l}),s.setOffset({top:l,width:a}),h.setOffset({left:a,top:l})):(e.hide(),i.hide(),s.hide(),h.setOffset({left:0,top:0}))}resetAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();p.call(this,t),w.call(this,e),this.resetOffset()}resetBRTAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();n.call(this,t),r.call(this,t),u.call(this,e),g.call(this,e),this.resetOffset()}resetBRLAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();n.call(this,t),f.call(this,t),u.call(this,e),d.call(this,e),this.resetOffset()}set(t,e,i=!0){const{data:s}=this,h=s.calSelectedRangeByStart(t,e),{sri:l,sci:a}=h;if(i){let[i,h]=[t,e];t<0&&(i=0),e<0&&(h=0),s.selector.setIndexes(i,h),this.indexes=[i,h]}this.moveIndexes=[l,a],this.range=h,this.resetAreaOffset(),this.el.show()}setEnd(t,e,i=!0){const{data:s,lastri:h,lastci:l}=this;if(i){if(t===h&&e===l)return;this.lastri=t,this.lastci=e}this.range=s.calSelectedRangeByEnd(t,e),p.call(this,this.data.getSelectedRect())}reset(){const{eri:t,eci:e}=this.data.selector.range;this.setEnd(t,e)}showAutofill(t,e){if(-1===t&&-1===e)return;const{sri:s,sci:h,eri:l,eci:n}=this.range,[r,f]=[t,e],d=s-t,u=l-t,g=n-e;if(h-e>0)this.arange=new i.CellRange(s,f,l,h-1);else if(d>0)this.arange=new i.CellRange(r,h,s-1,n);else if(g<0)this.arange=new i.CellRange(s,n+1,l,f);else{if(!(u<0))return void(this.arange=null);this.arange=new i.CellRange(l+1,h,r,n)}if(null!==this.arange){const t=this.data.getRect(this.arange);t.width+=2,t.height+=2;const{br:e,l:i,t:s,tl:h}=this;e.showAutofill(a.call(this,t)),i.showAutofill(c.call(this,t)),s.showAutofill(o.call(this,t)),h.showAutofill(t)}}hideAutofill(){["br","l","t","tl"].forEach(t=>{this[t].hideAutofill()})}showClipboard(){const t=this.data.getClipboardRect();w.call(this,t),["br","l","t","tl"].forEach(t=>{this[t].showClipboard()})}hideClipboard(){["br","l","t","tl"].forEach(t=>{this[t].hideClipboard()})}}});
//# sourceMappingURL=../sourcemaps/component/selector.js.map
