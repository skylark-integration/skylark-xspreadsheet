{"version":3,"sources":["spreadsheet.js"],"names":["define","m_element","DataProxy","Sheet","Bottombar","m_config","m_locale","[object Object]","selectors","options","targetEl","this","sheetIndex","datas","document","querySelector","bottombar","d","addSheet","sheet","resetData","index","deleteSheet","value","name","data","rootEl","h","cssPrefix","on","evt","preventDefault","appendChild","el","child","active","n","change","args","trigger","push","addItem","oldIndex","nindex","deleteItem","splice","ds","Array","isArray","clear","length","i","it","nd","setData","map","getData","ri","ci","text","setCellText","getCell","getCellStyle","table","render","eventName","func","validations","errors","size","cb","lang","message","locale"],"mappings":";;;;;;;AAAAA,QACI,sBACA,oBACA,oBACA,wBACA,WACA,mBAED,SAAUC,EAAWC,EAAWC,EAAOC,EAAWC,EAAUC,GAC3D,aAgGA,aA9FIC,YAAYC,EAAWC,MACnB,IAAIC,EAAWF,EACfG,KAAKF,QAAUA,EACfE,KAAKC,WAAa,EAClBD,KAAKE,SACoB,iBAAdL,IACPE,EAAWI,SAASC,cAAcP,IAEtCG,KAAKK,UAAY,IAAIZ,EAAU,KAC3B,MAAMa,EAAIN,KAAKO,WACfP,KAAKQ,MAAMC,UAAUH,IACtBI,IACC,MAAMJ,EAAIN,KAAKE,MAAMQ,GACrBV,KAAKQ,MAAMC,UAAUH,IACtB,KACCN,KAAKW,eACN,CAACD,EAAOE,KACPZ,KAAKE,MAAMQ,GAAOG,KAAOD,IAE7BZ,KAAKc,KAAOd,KAAKO,WACjB,MAAMQ,EAASzB,EAAU0B,EAAE,SAAWtB,EAASuB,aAAcC,GAAG,cAAeC,GAAOA,EAAIC,kBAC1FrB,EAASsB,YAAYN,EAAOO,IAC5BtB,KAAKQ,MAAQ,IAAIhB,EAAMuB,EAAQf,KAAKc,MACpCC,EAAOQ,MAAMvB,KAAKK,UAAUiB,IAEhC1B,SAASiB,EAAMW,GAAS,GACpB,MAAMC,EAAIZ,WAAiBb,KAAKC,aAC1BK,EAAI,IAAIf,EAAUkC,EAAGzB,KAAKF,SAOhC,OANAQ,EAAEoB,OAAS,KAAIC,KACX3B,KAAKQ,MAAMoB,QAAQ,YAAaD,KAEpC3B,KAAKE,MAAM2B,KAAKvB,GAChBN,KAAKK,UAAUyB,QAAQL,EAAGD,GAC1BxB,KAAKC,YAAc,EACZK,EAEXV,cACI,MAAOmC,EAAUC,GAAUhC,KAAKK,UAAU4B,aACtCF,GAAY,IACZ/B,KAAKE,MAAMgC,OAAOH,EAAU,GACxBC,GAAU,GACVhC,KAAKQ,MAAMC,UAAUT,KAAKE,MAAM8B,KAG5CpC,SAASkB,GACL,MAAMqB,EAAKC,MAAMC,QAAQvB,GAAQA,GAAQA,GAGzC,GAFAd,KAAKK,UAAUiC,QACftC,KAAKE,SACDiC,EAAGI,OAAS,EACZ,IAAK,IAAIC,EAAI,EAAGA,EAAIL,EAAGI,OAAQC,GAAK,EAAG,CACnC,MAAMC,EAAKN,EAAGK,GACRE,EAAK1C,KAAKO,SAASkC,EAAG5B,KAAY,IAAN2B,GAClCE,EAAGC,QAAQF,GACD,IAAND,GACAxC,KAAKQ,MAAMC,UAAUiC,GAIjC,OAAO1C,KAEXJ,UACI,OAAOI,KAAKE,MAAM0C,IAAIH,GAAMA,EAAGI,WAEnCjD,SAASkD,EAAIC,EAAIC,EAAM/C,EAAa,GAEhC,OADAD,KAAKE,MAAMD,GAAYgD,YAAYH,EAAIC,EAAIC,EAAM,YAC1ChD,KAEXJ,KAAKkD,EAAIC,EAAI9C,EAAa,GACtB,OAAOD,KAAKE,MAAMD,GAAYiD,QAAQJ,EAAIC,GAE9CnD,UAAUkD,EAAIC,EAAI9C,EAAa,GAC3B,OAAOD,KAAKE,MAAMD,GAAYkD,aAAaL,EAAIC,GAEnDnD,WAEI,OADAI,KAAKQ,MAAM4C,MAAMC,SACVrD,KAEXJ,GAAG0D,EAAWC,GAEV,OADAvD,KAAKQ,MAAMU,GAAGoC,EAAWC,GAClBvD,KAEXJ,WACI,MAAM4D,YAACA,GAAexD,KAAKc,KAC3B,OAAO0C,EAAYC,OAAOC,MAAQ,EAEtC9D,OAAO+D,GAEH,OADA3D,KAAKQ,MAAMU,GAAG,SAAUyC,GACjB3D,KAEXJ,cAAcgE,EAAMC,GAChBlE,EAASmE,OAAOF,EAAMC","file":"../spreadsheet.js","sourcesContent":["define([\n    './component/element',\n    './core/data_proxy',\n    './component/sheet',\n    './component/bottombar',\n    './config',\n    './locale/locale'\n//    './index.less'\n], function (m_element, DataProxy, Sheet, Bottombar, m_config, m_locale) {\n    'use strict';\n    class Spreadsheet {\n        constructor(selectors, options = {}) {\n            let targetEl = selectors;\n            this.options = options;\n            this.sheetIndex = 1;\n            this.datas = [];\n            if (typeof selectors === 'string') {\n                targetEl = document.querySelector(selectors);\n            }\n            this.bottombar = new Bottombar(() => {\n                const d = this.addSheet();\n                this.sheet.resetData(d);\n            }, index => {\n                const d = this.datas[index];\n                this.sheet.resetData(d);\n            }, () => {\n                this.deleteSheet();\n            }, (index, value) => {\n                this.datas[index].name = value;\n            });\n            this.data = this.addSheet();\n            const rootEl = m_element.h('div', `${ m_config.cssPrefix }`).on('contextmenu', evt => evt.preventDefault());\n            targetEl.appendChild(rootEl.el);\n            this.sheet = new Sheet(rootEl, this.data);\n            rootEl.child(this.bottombar.el);\n        }\n        addSheet(name, active = true) {\n            const n = name || `sheet${ this.sheetIndex }`;\n            const d = new DataProxy(n, this.options);\n            d.change = (...args) => {\n                this.sheet.trigger('change', ...args);\n            };\n            this.datas.push(d);\n            this.bottombar.addItem(n, active);\n            this.sheetIndex += 1;\n            return d;\n        }\n        deleteSheet() {\n            const [oldIndex, nindex] = this.bottombar.deleteItem();\n            if (oldIndex >= 0) {\n                this.datas.splice(oldIndex, 1);\n                if (nindex >= 0)\n                    this.sheet.resetData(this.datas[nindex]);\n            }\n        }\n        loadData(data) {\n            const ds = Array.isArray(data) ? data : [data];\n            this.bottombar.clear();\n            this.datas = [];\n            if (ds.length > 0) {\n                for (let i = 0; i < ds.length; i += 1) {\n                    const it = ds[i];\n                    const nd = this.addSheet(it.name, i === 0);\n                    nd.setData(it);\n                    if (i === 0) {\n                        this.sheet.resetData(nd);\n                    }\n                }\n            }\n            return this;\n        }\n        getData() {\n            return this.datas.map(it => it.getData());\n        }\n        cellText(ri, ci, text, sheetIndex = 0) {\n            this.datas[sheetIndex].setCellText(ri, ci, text, 'finished');\n            return this;\n        }\n        cell(ri, ci, sheetIndex = 0) {\n            return this.datas[sheetIndex].getCell(ri, ci);\n        }\n        cellStyle(ri, ci, sheetIndex = 0) {\n            return this.datas[sheetIndex].getCellStyle(ri, ci);\n        }\n        reRender() {\n            this.sheet.table.render();\n            return this;\n        }\n        on(eventName, func) {\n            this.sheet.on(eventName, func);\n            return this;\n        }\n        validate() {\n            const {validations} = this.data;\n            return validations.errors.size <= 0;\n        }\n        change(cb) {\n            this.sheet.on('change', cb);\n            return this;\n        }\n        static locale(lang, message) {\n            m_locale.locale(lang, message);\n        }\n    }\n\n    return Spreadsheet;\n\n});"]}