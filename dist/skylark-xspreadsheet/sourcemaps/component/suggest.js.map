{"version":3,"sources":["component/suggest.js"],"names":["define","m_element","m_event","m_config","inputEnter","evt","preventDefault","filterItems","this","length","stopPropagation","itemIndex","el","click","hide","[object Object]","items","itemClick","width","h","cssPrefix","css","v","cssRemoveKeys","offset","unbindClickoutside","parent","word","test","filter","it","key","startsWith","toUpperCase","map","title","item","child","on","label","html","children","show","bindClickoutside","input","keyCode","ctrlKey","toggle","call"],"mappings":";;;;;;;AAAAA,QACI,YACA,UACA,aACD,SAAUC,EAAWC,EAASC,GAC7B,aA4BA,SAASC,EAAWC,GAChBA,EAAIC,iBACJ,MAAMC,YAACA,GAAeC,KAClBD,EAAYE,QAAU,IAE1BJ,EAAIK,kBACAF,KAAKG,UAAY,IACjBH,KAAKG,UAAY,GACrBJ,EAAYC,KAAKG,WAAWC,GAAGC,QAC/BL,KAAKM,QA0FT,aA1DIC,YAAYC,EAAOC,EAAWC,EAAQ,SAClCV,KAAKD,eACLC,KAAKQ,MAAQA,EACbR,KAAKI,GAAKX,EAAUkB,EAAE,SAAWhB,EAASiB,qBAAsBC,IAAI,QAASH,GAAOJ,OACpFN,KAAKS,UAAYA,EACjBT,KAAKG,WAAa,EAEtBI,UAAUO,GACNd,KAAKI,GAAGW,cAAc,MAAO,UAAUC,OAAOF,GAElDP,OACI,MAAMH,GAACA,GAAMJ,KACbA,KAAKD,eACLC,KAAKG,WAAa,EAClBC,EAAGE,OACHZ,EAAQuB,mBAAmBjB,KAAKI,GAAGc,UAEvCX,SAASC,GACLR,KAAKQ,MAAQA,EAEjBD,OAAOY,GACH,IAAIX,MAACA,GAASR,KAuBd,GAtBK,QAAQoB,KAAKD,KACdX,EAAQA,EAAMa,OAAOC,IAAOA,EAAGC,KAAOD,GAAIE,WAAWL,EAAKM,iBAE9DjB,EAAQA,EAAMkB,IAAIJ,IACd,IAAIK,MAACA,GAASL,EACVK,EACqB,mBAAVA,IACPA,EAAQA,KAGZA,EAAQL,EAEZ,MAAMM,EAAOnC,EAAUkB,EAAE,SAAWhB,EAASiB,kBAAmBiB,MAAMF,GAAOG,GAAG,aAAc,KAC1F9B,KAAKS,UAAUa,GACftB,KAAKM,SAKT,OAHIgB,EAAGS,OACHH,EAAKC,MAAMpC,EAAUkB,EAAE,MAAO,SAASqB,KAAKV,EAAGS,QAE5CH,IAEX5B,KAAKD,YAAcS,EACfA,EAAMP,QAAU,EAChB,OAEJ,MAAMG,GAACA,GAAMJ,KACbI,EAAG4B,KAAK,IAAIC,YAAYzB,GAAO0B,OAC/BxC,EAAQyC,iBAAiB/B,EAAGc,SAAU,KAClClB,KAAKM,SAGbC,gBAAgB6B,GACZA,EAAMN,GAAG,UAAWjC,IApF5B,SAA6BA,GACzB,MAAMwC,QAACA,GAAWxC,EAIlB,OAHIA,EAAIyC,SACJzC,EAAIK,kBAEAmC,GACR,KAAK,GACDxC,EAAIK,kBACJ,MACJ,KAAK,IA/CT,SAAuBL,GACnBA,EAAIC,iBACJD,EAAIK,kBACJ,MAAMH,YAACA,GAAeC,KAClBD,EAAYE,QAAU,IAEtBD,KAAKG,WAAa,GAClBJ,EAAYC,KAAKG,WAAWoC,SAChCvC,KAAKG,WAAa,EACdH,KAAKG,UAAY,IACjBH,KAAKG,UAAYJ,EAAYE,OAAS,GAE1CF,EAAYC,KAAKG,WAAWoC,YAoCZC,KAAKxC,KAAMH,GACzB,MACF,KAAK,GACHA,EAAIK,kBACJ,MACF,KAAK,IAvCT,SAAuBL,GACnBA,EAAIK,kBACJ,MAAMH,YAACA,GAAeC,KAClBD,EAAYE,QAAU,IAEtBD,KAAKG,WAAa,GAClBJ,EAAYC,KAAKG,WAAWoC,SAChCvC,KAAKG,WAAa,EACdH,KAAKG,UAAYJ,EAAYE,OAAS,IACtCD,KAAKG,UAAY,GAErBJ,EAAYC,KAAKG,WAAWoC,YA6BZC,KAAKxC,KAAMH,GACzB,MACF,KAAK,GAGL,KAAK,EACHD,EAAW4C,KAAKxC,KAAMH,GACpB,MACJ,QACIA,EAAIK,qBA2D2CsC,KAAKxC,KAAMH","file":"../../component/suggest.js","sourcesContent":["define([\n    './element',\n    './event',\n    '../config'\n], function (m_element, m_event, m_config) {\n    'use strict';\n    function inputMovePrev(evt) {\n        evt.preventDefault();\n        evt.stopPropagation();\n        const {filterItems} = this;\n        if (filterItems.length <= 0)\n            return;\n        if (this.itemIndex >= 0)\n            filterItems[this.itemIndex].toggle();\n        this.itemIndex -= 1;\n        if (this.itemIndex < 0) {\n            this.itemIndex = filterItems.length - 1;\n        }\n        filterItems[this.itemIndex].toggle();\n    }\n    function inputMoveNext(evt) {\n        evt.stopPropagation();\n        const {filterItems} = this;\n        if (filterItems.length <= 0)\n            return;\n        if (this.itemIndex >= 0)\n            filterItems[this.itemIndex].toggle();\n        this.itemIndex += 1;\n        if (this.itemIndex > filterItems.length - 1) {\n            this.itemIndex = 0;\n        }\n        filterItems[this.itemIndex].toggle();\n    }\n    function inputEnter(evt) {\n        evt.preventDefault();\n        const {filterItems} = this;\n        if (filterItems.length <= 0)\n            return;\n        evt.stopPropagation();\n        if (this.itemIndex < 0)\n            this.itemIndex = 0;\n        filterItems[this.itemIndex].el.click();\n        this.hide();\n    }\n    function inputKeydownHandler(evt) {\n        const {keyCode} = evt;\n        if (evt.ctrlKey) {\n            evt.stopPropagation();\n        }\n        switch (keyCode) {\n        case 37: // left\n            evt.stopPropagation();\n            break;\n        case 38: // up\n          inputMovePrev.call(this, evt);\n          break;\n        case 39: // right\n          evt.stopPropagation();\n          break;\n        case 40: // down\n          inputMoveNext.call(this, evt);\n          break;\n        case 13: // enter\n          inputEnter.call(this, evt);\n          break;\n        case 9:\n          inputEnter.call(this, evt);\n            break;\n        default:\n            evt.stopPropagation();\n            break;\n        }\n    }\n    class Suggest {\n        constructor(items, itemClick, width = '200px') {\n            this.filterItems = [];\n            this.items = items;\n            this.el = m_element.h('div', `${ m_config.cssPrefix }-suggest`).css('width', width).hide();\n            this.itemClick = itemClick;\n            this.itemIndex = -1;\n        }\n        setOffset(v) {\n            this.el.cssRemoveKeys('top', 'bottom').offset(v);\n        }\n        hide() {\n            const {el} = this;\n            this.filterItems = [];\n            this.itemIndex = -1;\n            el.hide();\n            m_event.unbindClickoutside(this.el.parent());\n        }\n        setItems(items) {\n            this.items = items;\n        }\n        search(word) {\n            let {items} = this;\n            if (!/^\\s*$/.test(word)) {\n                items = items.filter(it => (it.key || it).startsWith(word.toUpperCase()));\n            }\n            items = items.map(it => {\n                let {title} = it;\n                if (title) {\n                    if (typeof title === 'function') {\n                        title = title();\n                    }\n                } else {\n                    title = it;\n                }\n                const item = m_element.h('div', `${ m_config.cssPrefix }-item`).child(title).on('click.stop', () => {\n                    this.itemClick(it);\n                    this.hide();\n                });\n                if (it.label) {\n                    item.child(m_element.h('div', 'label').html(it.label));\n                }\n                return item;\n            });\n            this.filterItems = items;\n            if (items.length <= 0) {\n                return;\n            }\n            const {el} = this;\n            el.html('').children(...items).show();\n            m_event.bindClickoutside(el.parent(), () => {\n                this.hide();\n            });\n        }\n        bindInputEvents(input) {\n            input.on('keydown', evt => inputKeydownHandler.call(this, evt));\n        }\n    }\n\n    return Suggest;\n});"]}