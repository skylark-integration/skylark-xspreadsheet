{"version":3,"sources":["component/sort_filter.js"],"names":["define","m_element","Button","m_event","m_config","m_locale","buildMenu","clsName","h","cssPrefix","buildSortItem","it","child","t","on","this","itemClick","resetFilterHeader","filterhEl","filterValues","values","html","length","checked","[object Object]","filterbEl","filterClick","el","children","sortAscEl","call","sortDescEl","btnClick","hide","ci","sortDesc","sort","ok","index","forEach","i","Array","from","toggle","push","splice","findIndex","items","filter","order","asc","desc","Object","keys","value","cnt","active","includes","v","offset","show","tindex","bindClickoutside","unbindClickoutside"],"mappings":"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","file":"../../component/sort_filter.js","sourcesContent":["define([\n    './element',\n    './button',\n    './event',\n    '../config',\n    '../locale/locale'\n], function (m_element, Button, m_event, m_config, m_locale) {\n    'use strict';\n    function buildMenu(clsName) {\n        return m_element.h('div', `${ m_config.cssPrefix }-item ${ clsName }`);\n    }\n    function buildSortItem(it) {\n        return buildMenu('state').child(m_locale.t(`sort.${ it }`)).on('click.stop', () => this.itemClick(it));\n    }\n    function buildFilterBody(items) {\n        const {filterbEl, filterValues} = this;\n        filterbEl.html('');\n        const itemKeys = Object.keys(items);\n        itemKeys.forEach((it, index) => {\n            const cnt = items[it];\n            const active = filterValues.includes(it) ? 'checked' : '';\n            filterbEl.child(m_element.h('div', `${ m_config.cssPrefix }-item state ${ active }`).on('click.stop', () => this.filterClick(index, it)).children(it === '' ? m_locale.t('filter.empty') : it, m_element.h('div', 'label').html(`(${ cnt })`)));\n        });\n    }\n    function resetFilterHeader() {\n        const {filterhEl, filterValues, values} = this;\n        filterhEl.html(`${ filterValues.length } / ${ values.length }`);\n        filterhEl.checked(filterValues.length === values.length);\n    }\n    return class SortFilter {\n        constructor() {\n            this.filterbEl = m_element.h('div', `${ m_config.cssPrefix }-body`);\n            this.filterhEl = m_element.h('div', `${ m_config.cssPrefix }-header state`).on('click.stop', () => this.filterClick(0, 'all'));\n            this.el = m_element.h('div', `${ m_config.cssPrefix }-sort-filter`).children(this.sortAscEl = buildSortItem.call(this, 'asc'), this.sortDescEl = buildSortItem.call(this, 'desc'), buildMenu('divider'), m_element.h('div', `${ m_config.cssPrefix }-filter`).children(this.filterhEl, this.filterbEl), m_element.h('div', `${ m_config.cssPrefix }-buttons`).children(new Button('cancel').on('click', () => this.btnClick('cancel')), new Button('ok', 'primary').on('click', () => this.btnClick('ok')))).hide();\n            this.ci = null;\n            this.sortDesc = null;\n            this.values = null;\n            this.filterValues = [];\n        }\n        btnClick(it) {\n            if (it === 'ok') {\n                const {ci, sort, filterValues} = this;\n                if (this.ok) {\n                    this.ok(ci, sort, 'in', filterValues);\n                }\n            }\n            this.hide();\n        }\n        itemClick(it) {\n            this.sort = it;\n            const {sortAscEl, sortDescEl} = this;\n            sortAscEl.checked(it === 'asc');\n            sortDescEl.checked(it === 'desc');\n        }\n        filterClick(index, it) {\n            const {filterbEl, filterValues, values} = this;\n            const children = filterbEl.children();\n            if (it === 'all') {\n                if (children.length === filterValues.length) {\n                    this.filterValues = [];\n                    children.forEach(i => m_element.h(i).checked(false));\n                } else {\n                    this.filterValues = Array.from(values);\n                    children.forEach(i => m_element.h(i).checked(true));\n                }\n            } else {\n                const checked = m_element.h(children[index]).toggle('checked');\n                if (checked) {\n                    filterValues.push(it);\n                } else {\n                    filterValues.splice(filterValues.findIndex(i => i === it), 1);\n                }\n            }\n            resetFilterHeader.call(this);\n        }\n        set(ci, items, filter, sort) {\n            this.ci = ci;\n            const {sortAscEl, sortDescEl} = this;\n            if (sort !== null) {\n                this.sort = sort.order;\n                sortAscEl.checked(sort.asc());\n                sortDescEl.checked(sort.desc());\n            } else {\n                this.sortDesc = null;\n                sortAscEl.checked(false);\n                sortDescEl.checked(false);\n            }\n            this.values = Object.keys(items);\n            this.filterValues = filter ? Array.from(filter.value) : Object.keys(items);\n            buildFilterBody.call(this, items, filter);\n            resetFilterHeader.call(this);\n        }\n        setOffset(v) {\n            this.el.offset(v).show();\n            let tindex = 1;\n            m_event.bindClickoutside(this.el, () => {\n                if (tindex <= 0) {\n                    this.hide();\n                }\n                tindex -= 1;\n            });\n        }\n        show() {\n            this.el.show();\n        }\n        hide() {\n            this.el.hide();\n            m_event.unbindClickoutside(this.el);\n        }\n    };\n});"]}