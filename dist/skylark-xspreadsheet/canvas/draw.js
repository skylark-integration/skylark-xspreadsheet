/**
 * skylark-xspreadsheet - A version of xspreadsheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(){"use strict";function t(){return window.devicePixelRatio||1}function e(){return t()-.5}function i(e){return parseInt(e*t(),10)}function s(t){const e=i(t);return e>0?e-.5:.5}function r(t,e,i,s,r,h,n){const o={x:0,y:0};"underline"===t?o.y="bottom"===r?0:"top"===r?-(h+2):-h/2:"strike"===t&&("bottom"===r?o.y=h/2:"top"===r&&(o.y=-(h/2+2))),"center"===s?o.x=n/2:"right"===s&&(o.x=n),this.line([e-o.x,i-o.y],[e-o.x+n,i-o.y])}return{Draw:class{constructor(e,i,s){this.el=e,this.ctx=e.getContext("2d"),this.resize(i,s),this.ctx.scale(t(),t())}resize(t,e){this.el.style.width=`${t}px`,this.el.style.height=`${e}px`,this.el.width=i(t),this.el.height=i(e)}clear(){const{width:t,height:e}=this.el;return this.ctx.clearRect(0,0,t,e),this}attr(t){return Object.assign(this.ctx,t),this}save(){return this.ctx.save(),this.ctx.beginPath(),this}restore(){return this.ctx.restore(),this}beginPath(){return this.ctx.beginPath(),this}translate(t,e){return this.ctx.translate(i(t),i(e)),this}scale(t,e){return this.ctx.scale(t,e),this}clearRect(t,e,i,s){return this.ctx.clearRect(t,e,i,s),this}fillRect(t,e,s,r){return this.ctx.fillRect(i(t)-.5,i(e)-.5,i(s),i(r)),this}fillText(t,e,s){return this.ctx.fillText(t,i(e),i(s)),this}text(t,e,s={},h=!0){const{ctx:n}=this,{align:o,valign:l,font:c,color:d,strike:a,underline:x}=s,u=e.textx(o);n.save(),n.beginPath(),this.attr({textAlign:o,textBaseline:l,font:`${c.italic?"italic":""} ${c.bold?"bold":""} ${i(c.size)}px ${c.name}`,fillStyle:d,strokeStyle:d});const g=`${t}`.split("\n"),f=e.innerWidth(),b=[];g.forEach(t=>{const e=n.measureText(t).width;if(h&&e>i(f)){let e={w:0,len:0,start:0};for(let s=0;s<t.length;s+=1)e.w>=i(f)&&(b.push(t.substr(e.start,e.len)),e={w:0,len:0,start:s}),e.len+=1,e.w+=n.measureText(t[s]).width+1;e.len>0&&b.push(t.substr(e.start,e.len))}else b.push(t)});const y=(b.length-1)*(c.size+2);let p=e.texty(l,y);return b.forEach(t=>{const e=n.measureText(t).width;this.fillText(t,u,p),a&&r.call(this,"strike",u,p,o,l,c.size,e),x&&r.call(this,"underline",u,p,o,l,c.size,e),p+=c.size+2}),n.restore(),this}border(t,s){const{ctx:r}=this;return r.lineWidth=e,r.strokeStyle=s,"medium"===t?r.lineWidth=i(2)-.5:"thick"===t?r.lineWidth=i(3):"dashed"===t?r.setLineDash([i(3),i(2)]):"dotted"===t?r.setLineDash([i(1),i(1)]):"double"===t&&r.setLineDash([i(2),0]),this}line(...t){const{ctx:e}=this;if(t.length>1){e.beginPath();const[i,r]=t[0];e.moveTo(s(i),s(r));for(let i=1;i<t.length;i+=1){const[r,h]=t[i];e.lineTo(s(r),s(h))}e.stroke()}return this}strokeBorders(t){const{ctx:e}=this;e.save();const{borderTop:i,borderRight:s,borderBottom:r,borderLeft:h}=t;i&&(this.border(...i),this.line(...t.topxys())),s&&(this.border(...s),this.line(...t.rightxys())),r&&(this.border(...r),this.line(...t.bottomxys())),h&&(this.border(...h),this.line(...t.leftxys())),e.restore()}dropdown(t){const{ctx:e}=this,{x:s,y:r,width:h,height:n}=t,o=s+h-15,l=r+n-15;e.save(),e.beginPath(),e.moveTo(i(o),i(l)),e.lineTo(i(o+8),i(l)),e.lineTo(i(o+4),i(l+6)),e.closePath(),e.fillStyle="rgba(0, 0, 0, .45)",e.fill(),e.restore()}error(t){const{ctx:e}=this,{x:s,y:r,width:h}=t,n=s+h-1;e.save(),e.beginPath(),e.moveTo(i(n-8),i(r-1)),e.lineTo(i(n),i(r-1)),e.lineTo(i(n),i(r+8)),e.closePath(),e.fillStyle="rgba(255, 0, 0, .65)",e.fill(),e.restore()}frozen(t){const{ctx:e}=this,{x:s,y:r,width:h}=t,n=s+h-1;e.save(),e.beginPath(),e.moveTo(i(n-8),i(r-1)),e.lineTo(i(n),i(r-1)),e.lineTo(i(n),i(r+8)),e.closePath(),e.fillStyle="rgba(0, 255, 0, .85)",e.fill(),e.restore()}rect(t,e){const{ctx:r}=this,{x:h,y:n,width:o,height:l,bgcolor:c}=t;r.save(),r.beginPath(),r.fillStyle=c||"#fff",r.rect(s(h+1),s(n+1),i(o-2),i(l-2)),r.clip(),r.fill(),e(),r.restore()}},DrawBox:class{constructor(t,e,i,s,r=0){this.x=t,this.y=e,this.width=i,this.height=s,this.padding=r,this.bgcolor="#ffffff",this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null}setBorders({top:t,bottom:e,left:i,right:s}){t&&(this.borderTop=t),s&&(this.borderRight=s),e&&(this.borderBottom=e),i&&(this.borderLeft=i)}innerWidth(){return this.width-2*this.padding-2}innerHeight(){return this.height-2*this.padding-2}textx(t){const{width:e,padding:i}=this;let{x:s}=this;return"left"===t?s+=i:"center"===t?s+=e/2:"right"===t&&(s+=e-i),s}texty(t,e){const{height:i,padding:s}=this;let{y:r}=this;return"top"===t?r+=s:"middle"===t?r+=i/2-e/2:"bottom"===t&&(r+=i-s-e),r}topxys(){const{x:t,y:e,width:i}=this;return[[t,e],[t+i,e]]}rightxys(){const{x:t,y:e,width:i,height:s}=this;return[[t+i,e],[t+i,e+s]]}bottomxys(){const{x:t,y:e,width:i,height:s}=this;return[[t,e+s],[t+i,e+s]]}leftxys(){const{x:t,y:e,height:i}=this;return[[t,e],[t,e+i]]}},thinLineWidth:e,npx:i}});
//# sourceMappingURL=../sourcemaps/canvas/draw.js.map
