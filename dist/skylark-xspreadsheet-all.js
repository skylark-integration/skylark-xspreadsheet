/**
 * skylark-xspreadsheet - A version of xspreadsheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,e){var s=e.define,require=e.require,i="function"==typeof s&&s.amd,r=!i&&"undefined"!=typeof exports;if(!i&&!s){var l={};s=e.define=function(t,e,s){"function"==typeof s?(l[t]={factory:s,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var s=e.split("/"),i=t.split("/");s.pop();for(var r=0;r<i.length;r++)"."!=i[r]&&(".."==i[r]?s.pop():s.push(i[r]));return s.join("/")}(e,t)}),resolved:!1,exports:null},require(t)):l[t]={factory:null,resolved:!0,exports:s}},require=e.require=function(t){if(!l.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var module=l[t];if(!module.resolved){var s=[];module.deps.forEach(function(t){s.push(require(t))}),module.exports=module.factory.apply(e,s)||null,module.resolved=!0}return module.exports}}if(!s)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,require){t("skylark-langx-ns/_attach",[],function(){return function(t,e,s){"string"==typeof e&&(e=e.split("."));for(var i=e.length,r=t,l=0,n=e[l++];l<i;)r=r[n]=r[n]||{},n=e[l++];if(r[n]){if(s)throw new Error("This namespace already exists:"+e)}else r[n]=s||{};return r[n]}}),t("skylark-langx-ns/ns",["./_attach"],function(t){var e={attach:function(s,i){return t(e,s,i)}};return e}),t("skylark-langx-ns/main",["./ns"],function(t){return t}),t("skylark-langx-ns",["skylark-langx-ns/main"],function(t){return t}),t("skylark-xspreadsheet/component/element",[],function(){"use strict";class t{constructor(t,e=""){"string"==typeof t?(this.el=document.createElement(t),this.el.className=e):this.el=t,this.data={}}data(t,e){return void 0!==e?(this.data[t]=e,this):this.data[t]}on(t,e){const[s,...i]=t.split(".");let r=s;return"mousewheel"===r&&/Firefox/i.test(window.navigator.userAgent)&&(r="DOMMouseScroll"),this.el.addEventListener(r,t=>{e(t);for(let e=0;e<i.length;e+=1){const s=i[e];if("left"===s&&0!==t.button)return;if("right"===s&&2!==t.button)return;"stop"===s&&t.stopPropagation()}}),this}offset(t){if(void 0!==t)return Object.keys(t).forEach(e=>{this.css(e,`${t[e]}px`)}),this;const{offsetTop:e,offsetLeft:s,offsetHeight:i,offsetWidth:r}=this.el;return{top:e,left:s,height:i,width:r}}scroll(t){const{el:e}=this;return void 0!==t&&(void 0!==t.left&&(e.scrollLeft=t.left),void 0!==t.top&&(e.scrollTop=t.top)),{left:e.scrollLeft,top:e.scrollTop}}box(){return this.el.getBoundingClientRect()}parent(){return new t(this.el.parentNode)}children(...t){return 0===arguments.length?this.el.childNodes:(t.forEach(t=>this.child(t)),this)}removeChild(t){this.el.removeChild(t)}child(e){let s=e;return"string"==typeof e?s=document.createTextNode(e):e instanceof t&&(s=e.el),this.el.appendChild(s),this}contains(t){return this.el.contains(t)}className(t){return void 0!==t?(this.el.className=t,this):this.el.className}addClass(t){return this.el.classList.add(t),this}hasClass(t){return this.el.classList.contains(t)}removeClass(t){return this.el.classList.remove(t),this}toggle(t="active"){return this.toggleClass(t)}toggleClass(t){return this.el.classList.toggle(t)}active(t=!0,e="active"){return t?this.addClass(e):this.removeClass(e),this}checked(t=!0){return this.active(t,"checked"),this}disabled(t=!0){return t?this.addClass("disabled"):this.removeClass("disabled"),this}attr(t,e){if(void 0!==e)this.el.setAttribute(t,e);else{if("string"==typeof t)return this.el.getAttribute(t);Object.keys(t).forEach(e=>{this.el.setAttribute(e,t[e])})}return this}removeAttr(t){return this.el.removeAttribute(t),this}html(t){return void 0!==t?(this.el.innerHTML=t,this):this.el.innerHTML}val(t){return void 0!==t?(this.el.value=t,this):this.el.value}focus(){this.el.focus()}cssRemoveKeys(...t){return t.forEach(t=>this.el.style.removeProperty(t)),this}css(t,e){return void 0===e&&"string"!=typeof t?(Object.keys(t).forEach(e=>{this.el.style[e]=t[e]}),this):void 0!==e?(this.el.style[t]=e,this):this.el.style[t]}computedStyle(){return window.getComputedStyle(this.el,null)}show(){return this.css("display","block"),this}hide(){return this.css("display","none"),this}}return{Element:t,h:(e,s="")=>new t(e,s)}}),t("skylark-xspreadsheet/core/alphabet",[],function(){"use strict";const t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function e(e){let s="",i=e;for(;i>=t.length;)i/=t.length,i-=1,s+=t[parseInt(i,10)%t.length];const r=e%t.length;return s+=t[r]}function s(e){let s=0;for(let i=0;i<e.length-1;i+=1){const r=e.charCodeAt(i)-65,l=e.length-1-i;s+=t.length**l+t.length*r}return s+=e.charCodeAt(e.length-1)-65}function i(t){let e="",i="";for(let s=0;s<t.length;s+=1)t.charAt(s)>="0"&&t.charAt(s)<="9"?i+=t.charAt(s):e+=t.charAt(s);return[s(e),parseInt(i,10)-1]}function r(t,s){return`${e(t)}${s+1}`}return{stringAt:e,indexAt:s,expr2xy:i,xy2expr:r,expr2expr:function(t,e,s,l=(()=>!0)){if(0===e&&0===s)return t;const[n,o]=i(t);return l(n,o)?r(n+e,o+s):t}}}),t("skylark-xspreadsheet/core/cell_range",["./alphabet"],function(t){"use strict";class e{constructor(t,e,s,i,r=0,l=0){this.sri=t,this.sci=e,this.eri=s,this.eci=i,this.w=r,this.h=l}set(t,e,s,i){this.sri=t,this.sci=e,this.eri=s,this.eci=i}multiple(){return this.eri-this.sri>0||this.eci-this.sci>0}includes(...e){let[s,i]=[0,0];1===e.length?[i,s]=t.expr2xy(e[0]):2===e.length&&([s,i]=e);const{sri:r,sci:l,eri:n,eci:o}=this;return r<=s&&s<=n&&l<=i&&i<=o}each(t,e=(()=>!0)){const{sri:s,sci:i,eri:r,eci:l}=this;for(let n=s;n<=r;n+=1)if(e(n))for(let e=i;e<=l;e+=1)t(n,e)}contains(t){return this.sri<=t.sri&&this.sci<=t.sci&&this.eri>=t.eri&&this.eci>=t.eci}within(t){return this.sri>=t.sri&&this.sci>=t.sci&&this.eri<=t.eri&&this.eci<=t.eci}disjoint(t){return this.sri>t.eri||this.sci>t.eci||t.sri>this.eri||t.sci>this.eci}intersects(t){return this.sri<=t.eri&&this.sci<=t.eci&&t.sri<=this.eri&&t.sci<=this.eci}union(t){const{sri:s,sci:i,eri:r,eci:l}=this;return new e(t.sri<s?t.sri:s,t.sci<i?t.sci:i,t.eri>r?t.eri:r,t.eci>l?t.eci:l)}difference(t){const s=[],i=(t,i,r,l)=>{s.push(new e(t,i,r,l))},{sri:r,sci:l,eri:n,eci:o}=this,h=t.sri-r,c=t.sci-l,a=n-t.eri,d=o-t.eci;return h>0?(i(r,l,t.sri-1,o),a>0?(i(t.eri+1,l,n,o),c>0&&i(t.sri,l,t.eri,t.sci-1),d>0&&i(t.sri,t.eci+1,t.eri,o)):(c>0&&i(t.sri,l,n,t.sci-1),d>0&&i(t.sri,t.eci+1,n,o))):a>0&&(i(t.eri+1,l,n,o),c>0&&i(r,l,t.eri,t.sci-1),d>0&&i(r,t.eci+1,t.eri,o)),c>0?(i(r,l,n,t.sci-1),d>0?(i(r,t.eri+1,n,o),h>0&&i(r,t.sci,t.sri-1,t.eci),a>0&&i(t.sri+1,t.sci,n,t.eci)):(h>0&&i(r,t.sci,t.sri-1,o),a>0&&i(t.sri+1,t.sci,n,o))):d>0&&(i(n,t.eci+1,n,o),h>0&&i(r,l,t.sri-1,t.eci),a>0&&i(t.eri+1,l,n,t.eci)),s}size(){return[this.eri-this.sri+1,this.eci-this.sci+1]}toString(){const{sri:e,sci:s,eri:i,eci:r}=this;let l=t.xy2expr(s,e);return this.multiple()&&(l=`${l}:${t.xy2expr(r,i)}`),l}clone(){const{sri:t,sci:s,eri:i,eci:r,w:l,h:n}=this;return new e(t,s,i,r,l,n)}equals(t){return this.eri===t.eri&&this.eci===t.eci&&this.sri===t.sri&&this.sci===t.sci}static valueOf(s){const i=s.split(":"),[r,l]=t.expr2xy(i[0]);let[n,o]=[l,r];return i.length>1&&([o,n]=t.expr2xy(i[1])),new e(l,r,n,o)}}return{CellRange:e}}),t("skylark-xspreadsheet/core/selector",["./cell_range"],function(t){"use strict";return class{constructor(){this.range=new t.CellRange(0,0,0,0),this.ri=0,this.ci=0}multiple(){return this.range.multiple()}setIndexes(t,e){this.ri=t,this.ci=e}size(){return this.range.size()}}}),t("skylark-xspreadsheet/core/scroll",[],function(){"use strict";return class{constructor(){this.x=0,this.y=0,this.ri=0,this.ci=0}}}),t("skylark-xspreadsheet/core/history",[],function(){"use strict";return class{constructor(){this.undoItems=[],this.redoItems=[]}add(t){this.undoItems.push(JSON.stringify(t)),this.redoItems=[]}canUndo(){return this.undoItems.length>0}canRedo(){return this.redoItems.length>0}undo(t,e){const{undoItems:s,redoItems:i}=this;this.canUndo()&&(i.push(JSON.stringify(t)),e(JSON.parse(s.pop())))}redo(t,e){const{undoItems:s,redoItems:i}=this;this.canRedo()&&(s.push(JSON.stringify(t)),e(JSON.parse(i.pop())))}}}),t("skylark-xspreadsheet/core/clipboard",[],function(){"use strict";return class{constructor(){this.range=null,this.state="clear"}copy(t){return this.range=t,this.state="copy",this}cut(t){return this.range=t,this.state="cut",this}isCopy(){return"copy"===this.state}isCut(){return"cut"===this.state}isClear(){return"clear"===this.state}clear(){this.range=null,this.state="clear"}}}),t("skylark-xspreadsheet/core/auto_filter",["./cell_range"],function(t){"use strict";class e{constructor(t,e,s){this.ci=t,this.operator=e,this.value=s}set(t,e){this.operator=t,this.value=e}includes(t){const{operator:e,value:s}=this;return"all"===e||"in"===e&&s.includes(t)}vlength(){const{operator:t,value:e}=this;return"in"===t?e.length:0}getData(){const{ci:t,operator:e,value:s}=this;return{ci:t,operator:e,value:s}}}class s{constructor(t,e){this.ci=t,this.order=e}asc(){return"asc"===this.order}desc(){return"desc"===this.order}}return class{constructor(){this.ref=null,this.filters=[],this.sort=null}setData({ref:t,filters:i,sort:r}){null!=t&&(this.ref=t,this.fitlers=i.map(t=>new e(t.ci,t.operator,t.value)),r&&(this.sort=new s(r.ci,r.order)))}getData(){if(this.active()){const{ref:t,filters:e,sort:s}=this;return{ref:t,filters:e.map(t=>t.getData()),sort:s}}return{}}addFilter(t,s,i){const r=this.getFilter(t);null==r?this.filters.push(new e(t,s,i)):r.set(s,i)}setSort(t,e){this.sort=e?new s(t,e):null}includes(t,e){return!!this.active()&&this.hrange().includes(t,e)}getSort(t){const{sort:e}=this;return e&&e.ci===t?e:null}getFilter(t){const{filters:e}=this;for(let s=0;s<e.length;s+=1)if(e[s].ci===t)return e[s];return null}filteredRows(t){const e=new Set,s=new Set;if(this.active()){const{sri:i,eri:r}=this.range(),{filters:l}=this;for(let n=i+1;n<=r;n+=1)for(let i=0;i<l.length;i+=1){const r=l[i],o=t(n,r.ci),h=o?o.text:"";if(!r.includes(h)){e.add(n);break}s.add(n)}}return{rset:e,fset:s}}items(t,e){const s={};if(this.active()){const{sri:i,eri:r}=this.range();for(let l=i+1;l<=r;l+=1){const i=e(l,t);if(null===i||/^\s*$/.test(i.text))s[""]=(s[""]||0)+1;else{const t=i.text,e=(s[t]||0)+1;s[t]=e}}}return s}range(){return t.CellRange.valueOf(this.ref)}hrange(){const t=this.range();return t.eri=t.sri,t}clear(){this.ref=null,this.filters=[],this.sort=null}active(){return null!==this.ref}}}),t("skylark-xspreadsheet/core/merge",["./cell_range"],function(t){"use strict";class e{constructor(t=[]){this._=t}forEach(t){this._.forEach(t)}deleteWithin(t){this._=this._.filter(e=>!e.within(t))}getFirstIncludes(t,e){for(let s=0;s<this._.length;s+=1){const i=this._[s];if(i.includes(t,e))return i}return null}filterIntersects(t){return new e(this._.filter(e=>e.intersects(t)))}intersects(t){for(let e=0;e<this._.length;e+=1){const s=this._[e];if(s.intersects(t))return!0}return!1}union(t){let e=t;return this._.forEach(t=>{t.intersects(e)&&(e=t.union(e))}),e}add(t){this.deleteWithin(t),this._.push(t)}shift(t,e,s,i){this._.forEach(r=>{const{sri:l,sci:n,eri:o,eci:h}=r,c=r;"row"===t?l>=e?(c.sri+=s,c.eri+=s):l<e&&e<=o&&(c.eri+=s,i(l,n,s,0)):"column"===t&&(n>=e?(c.sci+=s,c.eci+=s):n<e&&e<=h&&(c.eci+=s,i(l,n,0,s)))})}move(t,e,s){this._.forEach(i=>{const r=i;r.within(t)&&(r.eri+=e,r.sri+=e,r.sci+=s,r.eci+=s)})}setData(e){return this._=e.map(e=>t.CellRange.valueOf(e)),this}getData(){return this._.map(t=>t.toString())}}return{Merges:e}}),t("skylark-xspreadsheet/core/helper",[],function(){"use strict";const t=(e={},...s)=>(s.forEach(s=>{Object.keys(s).forEach(i=>{const r=s[i];"string"==typeof r||"number"==typeof r||"boolean"==typeof r?e[i]=r:"function"!=typeof r&&!Array.isArray(r)&&r instanceof Object?(e[i]=e[i]||{},t(e[i],r)):e[i]=r})}),e);function e(t){const e=`${t}`;let s=0,i=!1;for(let t=0;t<e.length;t+=1)!0===i&&(s+=1),"."===e.charAt(t)&&(i=!0);return s}return{cloneDeep:function(t){return JSON.parse(JSON.stringify(t))},merge:(...e)=>t({},...e),equals:function t(e,s){const i=Object.keys(e);if(i.length!==Object.keys(s).length)return!1;for(let r=0;r<i.length;r+=1){const l=i[r],n=e[l],o=s[l];if(void 0===o)return!1;if("string"==typeof n||"number"==typeof n||"boolean"==typeof n){if(n!==o)return!1}else if(Array.isArray(n)){if(n.length!==o.length)return!1;for(let e=0;e<n.length;e+=1)if(!t(n[e],o[e]))return!1}else if("function"!=typeof n&&!Array.isArray(n)&&n instanceof Object&&!t(n,o))return!1}return!0},arrayEquals:function(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s+=1)if(t[s]!==e[s])return!1;return!0},sum:(t,e=(t=>t))=>{let s=0,i=0;return Object.keys(t).forEach(r=>{s+=e(t[r],r),i+=1}),[s,i]},rangeEach:function(t,e,s){for(let i=t;i<e;i+=1)s(i)},rangeSum:function(t,e,s){let i=0;for(let r=t;r<e;r+=1)i+=s(r);return i},rangeReduceIf:function(t,e,s,i,r,l){let n=s,o=i,h=t;for(;h<e&&!(n>r);h+=1)o=l(h),n+=o;return[h,n-o,o]},deleteProperty:function(t,e){const s=t[`${e}`];return delete t[`${e}`],s},numberCalc:function(t,s,i){if(Number.isNaN(s)||Number.isNaN(i))return s+t+i;const r=e(s),l=e(i),n=Number(s),o=Number(i);let h=0;if("-"===t)h=n-o;else if("+"===t)h=n+o;else if("*"===t)h=n*o;else if("/"===t)return e(h=n/o)>5?h.toFixed(2):h;return h.toFixed(Math.max(r,l))}}}),t("skylark-xspreadsheet/core/row",["./helper","./alphabet"],function(t,e){"use strict";return{Rows:class{constructor({len:t,height:e}){this._={},this.len=t,this.height=e}getHeight(t){if(this.isHide(t))return 0;const e=this.get(t);return e&&e.height?e.height:this.height}setHeight(t,e){const s=this.getOrNew(t);s.height=e}unhide(t){let e=t;for(;e>0&&(e-=1,this.isHide(e));)this.setHide(e,!1)}isHide(t){const e=this.get(t);return e&&e.hide}setHide(t,e){const s=this.getOrNew(t);!0===e?s.hide=!0:delete s.hide}setStyle(t,e){const s=this.getOrNew(t);s.style=e}sumHeight(e,s,i){return t.rangeSum(e,s,t=>i&&i.has(t)?0:this.getHeight(t))}totalHeight(){return this.sumHeight(0,this.len)}get(t){return this._[t]}getOrNew(t){return this._[t]=this._[t]||{cells:{}},this._[t]}getCell(t,e){const s=this.get(t);return void 0!==s&&void 0!==s.cells&&void 0!==s.cells[e]?s.cells[e]:null}getCellMerge(t,e){const s=this.getCell(t,e);return s&&s.merge?s.merge:[0,0]}getCellOrNew(t,e){const s=this.getOrNew(t);return s.cells[e]=s.cells[e]||{},s.cells[e]}setCell(t,e,s,i="all"){const r=this.getOrNew(t);"all"===i?r.cells[e]=s:"text"===i?(r.cells[e]=r.cells[e]||{},r.cells[e].text=s.text):"format"===i&&(r.cells[e]=r.cells[e]||{},r.cells[e].style=s.style,s.merge&&(r.cells[e].merge=s.merge))}setCellText(t,e,s){const i=this.getCellOrNew(t,e);i.text=s}copyPaste(s,i,r,l=!1,n=(()=>{})){const{sri:o,sci:h,eri:c,eci:a}=s,d=i.sri,u=i.sci,f=i.eri,p=i.eci,[g,m]=s.size(),[w,x]=i.size();let b=!0,v=0;(f<o||p<h)&&(b=!1,v=f<o?w:x);for(let s=o;s<=c;s+=1)if(this._[s])for(let i=h;i<=a;i+=1)if(this._[s].cells&&this._[s].cells[i])for(let w=d;w<=f;w+=g)for(let x=u;x<=p;x+=m){const y=w+(s-o),k=x+(i-h),C=t.cloneDeep(this._[s].cells[i]);if(l&&C&&C.text&&C.text.length>0){const{text:t}=C;let s=x-u+(w-d)+2;if(b||(s-=v+1),"="===t[0])C.text=t.replace(/[a-zA-Z]{1,3}\d+/g,t=>{let[i,r]=[0,0];return o===d?i=s-1:r=s-1,/^\d+$/.test(t)?t:e.expr2expr(t,i,r)});else if(g<=1&&m>1&&(d>c||f<o)||m<=1&&g>1&&(u>a||p<h)||g<=1&&m<=1){const e=/[\\.\d]+$/.exec(t);if(null!==e){const i=Number(e[0])+s-1;C.text=t.substring(0,e.index)+i}}}this.setCell(y,k,C,r),n(y,k,C)}}cutPaste(t,e){const s={};this.each(i=>{this.eachCells(i,r=>{let l=parseInt(i,10),n=parseInt(r,10);t.includes(i,r)&&(l=e.sri+(l-t.sri),n=e.sci+(n-t.sci)),s[l]=s[l]||{cells:{}},s[l].cells[n]=this._[i].cells[r]})}),this._=s}paste(t,e){if(t.length<=0)return;const{sri:s,sci:i}=e;t.forEach((t,e)=>{const r=s+e;t.forEach((t,e)=>{const s=i+e;this.setCellText(r,s,t)})})}insert(t,s=1){const i={};this.each((r,l)=>{let n=parseInt(r,10);n>=t&&(n+=s,this.eachCells(r,(i,r)=>{r.text&&"="===r.text[0]&&(r.text=r.text.replace(/[a-zA-Z]{1,3}\d+/g,i=>e.expr2expr(i,0,s,(e,s)=>s>=t)))})),i[n]=l}),this._=i,this.len+=s}delete(t,s){const i=s-t+1,r={};this.each((l,n)=>{const o=parseInt(l,10);o<t?r[o]=n:l>s&&(r[o-i]=n,this.eachCells(l,(t,r)=>{r.text&&"="===r.text[0]&&(r.text=r.text.replace(/[a-zA-Z]{1,3}\d+/g,t=>e.expr2expr(t,0,-i,(t,e)=>e>s)))}))}),this._=r,this.len-=i}insertColumn(t,s=1){this.each((i,r)=>{const l={};this.eachCells(i,(i,r)=>{let n=parseInt(i,10);n>=t&&(n+=s,r.text&&"="===r.text[0]&&(r.text=r.text.replace(/[a-zA-Z]{1,3}\d+/g,i=>e.expr2expr(i,s,0,e=>e>=t)))),l[n]=r}),r.cells=l})}deleteColumn(t,s){const i=s-t+1;this.each((r,l)=>{const n={};this.eachCells(r,(r,l)=>{const o=parseInt(r,10);o<t?n[o]=l:o>s&&(n[o-i]=l,l.text&&"="===l.text[0]&&(l.text=l.text.replace(/[a-zA-Z]{1,3}\d+/g,t=>e.expr2expr(t,-i,0,t=>t>s))))}),l.cells=n})}deleteCells(t,e="all"){t.each((t,s)=>{this.deleteCell(t,s,e)})}deleteCell(t,e,s="all"){const i=this.get(t);if(null!==i){const r=this.getCell(t,e);null!==r&&("all"===s?delete i.cells[e]:"text"===s?(r.text&&delete r.text,r.value&&delete r.value):"format"===s?(void 0!==r.style&&delete r.style,r.merge&&delete r.merge):"merge"===s&&r.merge&&delete r.merge)}}maxCell(){const t=Object.keys(this._),e=t[t.length-1],s=this._[e];if(s){const{cells:t}=s,i=Object.keys(t),r=i[i.length-1];return[parseInt(e,10),parseInt(r,10)]}return[0,0]}each(t){Object.entries(this._).forEach(([e,s])=>{t(e,s)})}eachCells(t,e){this._[t]&&this._[t].cells&&Object.entries(this._[t].cells).forEach(([t,s])=>{e(t,s)})}setData(t){t.len&&(this.len=t.len,delete t.len),this._=t}getData(){const{len:t}=this;return Object.assign({len:t},this._)}}}}),t("skylark-xspreadsheet/core/col",["./helper"],function(t){"use strict";return{Cols:class{constructor({len:t,width:e,indexWidth:s,minWidth:i}){this._={},this.len=t,this.width=e,this.indexWidth=s,this.minWidth=i}setData(t){t.len&&(this.len=t.len,delete t.len),this._=t}getData(){const{len:t}=this;return Object.assign({len:t},this._)}getWidth(t){if(this.isHide(t))return 0;const e=this._[t];return e&&e.width?e.width:this.width}getOrNew(t){return this._[t]=this._[t]||{},this._[t]}setWidth(t,e){const s=this.getOrNew(t);s.width=e}unhide(t){let e=t;for(;e>0&&(e-=1,this.isHide(e));)this.setHide(e,!1)}isHide(t){const e=this._[t];return e&&e.hide}setHide(t,e){const s=this.getOrNew(t);!0===e?s.hide=!0:delete s.hide}setStyle(t,e){const s=this.getOrNew(t);s.style=e}sumWidth(e,s){return t.rangeSum(e,s,t=>this.getWidth(t))}totalWidth(){return this.sumWidth(0,this.len)}}}}),t("skylark-xspreadsheet/locale/en",[],function(){"use strict";return{toolbar:{undo:"Undo",redo:"Redo",print:"Print",paintformat:"Paint format",clearformat:"Clear format",format:"Format",fontName:"Font",fontSize:"Font size",fontBold:"Font bold",fontItalic:"Font italic",underline:"Underline",strike:"Strike",color:"Text color",bgcolor:"Fill color",border:"Borders",merge:"Merge cells",align:"Horizontal align",valign:"Vertical align",textwrap:"Text wrapping",freeze:"Freeze cell",autofilter:"Filter",formula:"Functions",more:"More"},contextmenu:{copy:"Copy",cut:"Cut",paste:"Paste",pasteValue:"Paste values only",pasteFormat:"Paste format only",hide:"Hide",insertRow:"Insert row",insertColumn:"Insert column",deleteSheet:"Delete",deleteRow:"Delete row",deleteColumn:"Delete column",deleteCell:"Delete cell",deleteCellText:"Delete cell text",validation:"Data validations",cellprintable:"Enable export",cellnonprintable:"Disable export",celleditable:"Enable editing",cellnoneditable:"Disable editing"},print:{size:"Paper size",orientation:"Page orientation",orientations:["Landscape","Portrait"]},format:{normal:"Normal",text:"Plain Text",number:"Number",percent:"Percent",rmb:"RMB",usd:"USD",eur:"EUR",date:"Date",time:"Time",datetime:"Date time",duration:"Duration"},formula:{sum:"Sum",average:"Average",max:"Max",min:"Min",_if:"IF",and:"AND",or:"OR",concat:"Concat"},validation:{required:"it must be required",notMatch:"it not match its validation rule",between:"it is between {} and {}",notBetween:"it is not between {} and {}",notIn:"it is not in list",equal:"it equal to {}",notEqual:"it not equal to {}",lessThan:"it less than {}",lessThanEqual:"it less than or equal to {}",greaterThan:"it greater than {}",greaterThanEqual:"it greater than or equal to {}"},error:{pasteForMergedCell:"Unable to do this for merged cells"},calendar:{weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]},button:{next:"Next",cancel:"Cancel",remove:"Remove",save:"Save",ok:"OK"},sort:{desc:"Sort Z -> A",asc:"Sort A -> Z"},filter:{empty:"empty"},dataValidation:{mode:"Mode",range:"Cell Range",criteria:"Criteria",modeType:{cell:"Cell",column:"Colun",row:"Row"},type:{list:"List",number:"Number",date:"Date",phone:"Phone",email:"Email"},operator:{be:"between",nbe:"not betwwen",lt:"less than",lte:"less than or equal to",gt:"greater than",gte:"greater than or equal to",eq:"equal to",neq:"not equal to"}}}}),t("skylark-xspreadsheet/locale/locale",["./en"],function(t){"use strict";let e="en";const s={en:t};function i(t,s){if(s&&s[e]){let i=s[e];const r=t.split(".");for(let t=0;t<r.length;t+=1){const e=r[t],s=i[e];if(t===r.length-1)return s;if(!s)return;i=s}}}function r(t){let e=i(t,s);return!e&&window&&window.x_spreadsheet&&window.x_spreadsheet.$messages&&(e=i(t,window.x_spreadsheet.$messages)),e||""}return{locale:function(t,i){e=t,i&&(s[t]=i)},t:r,tf:function(t){return()=>r(t)}}}),t("skylark-xspreadsheet/core/validator",["../locale/locale","./helper"],function(t,e){"use strict";const s={phone:/^[1-9]\d{10}$/,email:/w+([-+.]w+)*@w+([-.]w+)*.w+([-.]w+)*/};function i(e,s,...i){let r="";return e||(r=t.t(`validation.${s}`,...i)),[e,r]}return class{constructor(t,e,s,i){this.required=e,this.value=s,this.type=t,this.operator=i,this.message=""}parseValue(t){const{type:e}=this;return"date"===e?new Date(t):"number"===e?Number(t):t}equals(t){let s=this.type===t.type&&this.required===t.required&&this.operator===t.operator;return s&&(s=Array.isArray(this.value)?e.arrayEquals(this.value,t.value):this.value===t.value),s}values(){return this.value.split(",")}validate(t){const{required:e,operator:r,value:l,type:n}=this;if(e&&/^\s*$/.test(t))return i(!1,"required");if(/^\s*$/.test(t))return[!0];if(s[n]&&!s[n].test(t))return i(!1,"notMatch");if("list"===n)return i(this.values().includes(t),"notIn");if(r){const e=this.parseValue(t);if("be"===r){const[t,s]=l;return i(e>=this.parseValue(t)&&e<=this.parseValue(s),"between",t,s)}if("nbe"===r){const[t,s]=l;return i(e<this.parseValue(t)||e>this.parseValue(s),"notBetween",t,s)}if("eq"===r)return i(e===this.parseValue(l),"equal",l);if("neq"===r)return i(e!==this.parseValue(l),"notEqual",l);if("lt"===r)return i(e<this.parseValue(l),"lessThan",l);if("lte"===r)return i(e<=this.parseValue(l),"lessThanEqual",l);if("gt"===r)return i(e>this.parseValue(l),"greaterThan",l);if("gte"===r)return i(e>=this.parseValue(l),"greaterThanEqual",l)}return[!0]}}}),t("skylark-xspreadsheet/core/validation",["./validator","./cell_range"],function(t,e){"use strict";class s{constructor(t,e,s){this.refs=e,this.mode=t,this.validator=s}includes(t,s){const{refs:i}=this;for(let r=0;r<i.length;r+=1){const l=e.CellRange.valueOf(i[r]);if(l.includes(t,s))return!0}return!1}addRef(t){this.remove(e.CellRange.valueOf(t)),this.refs.push(t)}remove(t){const s=[];this.refs.forEach(i=>{const r=e.CellRange.valueOf(i);if(r.intersects(t)){const e=r.difference(t);e.forEach(t=>s.push(t.toString()))}else s.push(i)}),this.refs=s}getData(){const{refs:t,mode:e,validator:s}=this,{type:i,required:r,operator:l,value:n}=s;return{refs:t,mode:e,type:i,required:r,operator:l,value:n}}static valueOf({refs:e,mode:i,type:r,required:l,operator:n,value:o}){return new s(i,e,new t(r,l,o,n))}}return{Validations:class{constructor(){this._=[],this.errors=new Map}getError(t,e){return this.errors.get(`${t}_${e}`)}validate(t,e,s){const i=this.get(t,e),r=`${t}_${e}`,{errors:l}=this;if(null!==i){const[t,e]=i.validator.validate(s);t?l.delete(r):l.set(r,e)}else l.delete(r);return!0}add(e,i,{type:r,required:l,value:n,operator:o}){const h=new t(r,l,n,o),c=this.getByValidator(h);null!==c?c.addRef(i):this._.push(new s(e,[i],h))}getByValidator(t){for(let e=0;e<this._.length;e+=1){const s=this._[e];if(s.validator.equals(t))return s}return null}get(t,e){for(let s=0;s<this._.length;s+=1){const i=this._[s];if(i.includes(t,e))return i}return null}remove(t){this.each(e=>{e.remove(t)})}each(t){this._.forEach(e=>t(e))}getData(){return this._.filter(t=>t.refs.length>0).map(t=>t.getData())}setData(t){this._=t.map(t=>s.valueOf(t))}}}}),t("skylark-xspreadsheet/core/data_proxy",["./selector","./scroll","./history","./clipboard","./auto_filter","./merge","./helper","./row","./col","./validation","./cell_range","./alphabet","../locale/locale"],function(t,e,s,i,r,l,n,o,h,c,a,d,u){"use strict";const f={mode:"edit",view:{height:()=>document.documentElement.clientHeight,width:()=>document.documentElement.clientWidth},showGrid:!0,showToolbar:!0,showContextmenu:!0,row:{len:100,height:25},col:{len:26,width:100,indexWidth:60,minWidth:60},style:{bgcolor:"#ffffff",align:"left",valign:"middle",textwrap:!1,strike:!1,underline:!1,color:"#0a0a0a",font:{name:"Arial",size:10,bold:!1,italic:!1},format:"normal"}};function p(t,e,s=(()=>{})){const{merges:i}=this,r=e.clone(),[l,n]=t.size(),[o,h]=e.size();return l>o&&(r.eri=e.sri+l-1),n>h&&(r.eci=e.sci+n-1),!i.intersects(r)||(s(u.t("error.pasteForMergedCell")),!1)}function g(t,e,s,i=!1){const{rows:r,merges:l}=this;"all"!==s&&"format"!==s||(r.deleteCells(e,s),l.deleteWithin(e)),r.copyPaste(t,e,s,i,(t,e,s)=>{if(s&&s.merge){const[i,r]=s.merge;if(i<=0&&r<=0)return;l.add(new a.CellRange(t,e,t+i,e+r))}})}function m(t,e,s){const{styles:i,rows:r}=this,l=r.getCellOrNew(t,e);let o={};void 0!==l.style&&(o=n.cloneDeep(i[l.style])),o=n.merge(o,{border:s}),l.style=this.addStyle(o)}return class{constructor(a,d){this.settings=n.merge(f,d||{}),this.name=a||"sheet",this.freeze=[0,0],this.styles=[],this.merges=new l.Merges,this.rows=new o.Rows(this.settings.row),this.cols=new h.Cols(this.settings.col),this.validations=new c.Validations,this.hyperlinks={},this.comments={},this.selector=new t,this.scroll=new e,this.history=new s,this.clipboard=new i,this.autoFilter=new r,this.change=(()=>{}),this.exceptRowSet=new Set,this.sortedRowMap=new Map,this.unsortedRowMap=new Map}addValidation(t,e,s){this.changeData(()=>{this.validations.add(t,e,s)})}removeValidation(){const{range:t}=this.selector;this.changeData(()=>{this.validations.remove(t)})}getSelectedValidator(){const{ri:t,ci:e}=this.selector,s=this.validations.get(t,e);return s?s.validator:null}getSelectedValidation(){const{ri:t,ci:e,range:s}=this.selector,i=this.validations.get(t,e),r={ref:s.toString()};return null!==i&&(r.mode=i.mode,r.validator=i.validator),r}canUndo(){return this.history.canUndo()}canRedo(){return this.history.canRedo()}undo(){this.history.undo(this.getData(),t=>{this.setData(t)})}redo(){this.history.redo(this.getData(),t=>{this.setData(t)})}copy(){this.clipboard.copy(this.selector.range)}cut(){this.clipboard.cut(this.selector.range)}paste(t="all",e=(()=>{})){const{clipboard:s,selector:i}=this;return!s.isClear()&&(!!p.call(this,s.range,i.range,e)&&(this.changeData(()=>{s.isCopy()?g.call(this,s.range,i.range,t):s.isCut()&&function(t,e){const{clipboard:s,rows:i,merges:r}=this;i.cutPaste(t,e),r.move(t,e.sri-t.sri,e.sci-t.sci),s.clear()}.call(this,s.range,i.range)}),!0))}pasteFromText(t){const e=t.split("\r\n").map(t=>t.replace(/"/g,"").split("\t"));e.length>0&&(e.length-=1);const{rows:s,selector:i}=this;this.changeData(()=>{s.paste(e,i.range)})}autofill(t,e,s=(()=>{})){const i=this.selector.range;return!!p.call(this,i,t,s)&&(this.changeData(()=>{g.call(this,i,t,e,!0)}),!0)}clearClipboard(){this.clipboard.clear()}calSelectedRangeByEnd(t,e){const{selector:s,rows:i,cols:r,merges:l}=this;let{sri:n,sci:o,eri:h,eci:c}=s.range;const d=s.ri,u=s.ci;let[f,p]=[t,e];return t<0&&(f=i.len-1),e<0&&(p=r.len-1),[n,h]=f>d?[d,f]:[f,d],[o,c]=p>u?[u,p]:[p,u],s.range=l.union(new a.CellRange(n,o,h,c)),s.range=l.union(s.range),s.range}calSelectedRangeByStart(t,e){const{selector:s,rows:i,cols:r,merges:l}=this;let n=l.getFirstIncludes(t,e);return null===n&&(n=new a.CellRange(t,e,t,e),-1===t&&(n.sri=0,n.eri=i.len-1),-1===e&&(n.sci=0,n.eci=r.len-1)),s.range=n,n}setSelectedCellAttr(t,e){this.changeData(()=>{const{selector:s,styles:i,rows:r}=this;if("merge"===t)e?this.merge():this.unmerge();else if("border"===t)(function({mode:t,style:e,color:s}){const{styles:i,selector:r,rows:l}=this,{sri:o,sci:h,eri:c,eci:a}=r.range,d=!this.isSignleSelected();if(!d&&("inside"===t||"horizontal"===t||"vertical"===t))return;if("outside"!==t||d){if("none"===t)r.range.each((t,e)=>{const s=l.getCell(t,e);if(s&&void 0!==s.style){const t=n.cloneDeep(i[s.style]);delete t.border,s.style=this.addStyle(t)}});else if("all"===t||"inside"===t||"outside"===t||"horizontal"===t||"vertical"===t){const i=[];for(let r=o;r<=c;r+=1)for(let n=h;n<=a;n+=1){const u=[];for(let t=0;t<i.length;t+=1){const[e,s,l,o]=i[t];if(r===e+l+1&&u.push(t),e<=r&&r<=e+l&&n===s){n+=o+1;break}}if(u.forEach(t=>i.splice(t,1)),n>a)break;const f=l.getCell(r,n);let[p,g]=[0,0];f&&f.merge&&([p,g]=f.merge,i.push([r,n,p,g]));const w=p>0&&r+p===c,x=g>0&&n+g===a;let b={};"all"===t?b={bottom:[e,s],top:[e,s],left:[e,s],right:[e,s]}:"inside"===t?(!x&&n<a&&(b.right=[e,s]),!w&&r<c&&(b.bottom=[e,s])):"horizontal"===t?!w&&r<c&&(b.bottom=[e,s]):"vertical"===t?!x&&n<a&&(b.right=[e,s]):"outside"===t&&d&&(o===r&&(b.top=[e,s]),(w||c===r)&&(b.bottom=[e,s]),h===n&&(b.left=[e,s]),(x||a===n)&&(b.right=[e,s])),Object.keys(b).length>0&&m.call(this,r,n,b),n+=g}}else if("top"===t||"bottom"===t)for(let i=h;i<=a;i+=1)"top"===t&&(m.call(this,o,i,{top:[e,s]}),i+=l.getCellMerge(o,i)[1]),"bottom"===t&&(m.call(this,c,i,{bottom:[e,s]}),i+=l.getCellMerge(c,i)[1]);else if("left"===t||"right"===t)for(let i=o;i<=c;i+=1)"left"===t&&(m.call(this,i,h,{left:[e,s]}),i+=l.getCellMerge(i,h)[0]),"right"===t&&(m.call(this,i,a,{right:[e,s]}),i+=l.getCellMerge(i,a)[0])}else m.call(this,o,h,{top:[e,s],bottom:[e,s],left:[e,s],right:[e,s]})}).call(this,e);else if("formula"===t){const{ri:t,ci:i,range:l}=s;if(s.multiple()){const[i,n]=s.size(),{sri:o,sci:h,eri:c,eci:a}=l;if(i>1)for(let t=h;t<=a;t+=1){const s=r.getCellOrNew(c+1,t);s.text=`=${e}(${d.xy2expr(t,o)}:${d.xy2expr(t,c)})`}else if(n>1){const s=r.getCellOrNew(t,a+1);s.text=`=${e}(${d.xy2expr(h,t)}:${d.xy2expr(a,t)})`}}else{const s=r.getCellOrNew(t,i);s.text=`=${e}()`}}else s.range.each((s,l)=>{const o=r.getCellOrNew(s,l);let h={};if(void 0!==o.style&&(h=n.cloneDeep(i[o.style])),"format"===t)h.format=e,o.style=this.addStyle(h);else if("font-bold"===t||"font-italic"===t||"font-name"===t||"font-size"===t){const s={};s[t.split("-")[1]]=e,h.font=Object.assign(h.font||{},s),o.style=this.addStyle(h)}else"strike"===t||"textwrap"===t||"underline"===t||"align"===t||"valign"===t||"color"===t||"bgcolor"===t?(h[t]=e,o.style=this.addStyle(h)):o[t]=e})})}setSelectedCellText(t,e="input"){const{autoFilter:s,selector:i,rows:r}=this,{ri:l,ci:n}=i;let o=l;this.unsortedRowMap.has(l)&&(o=this.unsortedRowMap.get(l));const h=r.getCell(o,n),c=h?h.text:"";if(this.setCellText(o,n,t,e),s.active()){const e=s.getFilter(n);if(e){const s=e.value.findIndex(t=>t===c);s>=0&&e.value.splice(s,1,t)}}}getSelectedCell(){const{ri:t,ci:e}=this.selector;let s=t;return this.unsortedRowMap.has(t)&&(s=this.unsortedRowMap.get(t)),this.rows.getCell(s,e)}xyInSelectedRect(t,e){const{left:s,top:i,width:r,height:l}=this.getSelectedRect(),n=t-this.cols.indexWidth,o=e-this.rows.height;return n>s&&n<s+r&&o>i&&o<i+l}getSelectedRect(){return this.getRect(this.selector.range)}getClipboardRect(){const{clipboard:t}=this;return t.isClear()?{left:-100,top:-100}:this.getRect(t.range)}getRect(t){const{scroll:e,rows:s,cols:i,exceptRowSet:r}=this,{sri:l,sci:n,eri:o,eci:h}=t;if(l<0&&n<0)return{left:0,l:0,top:0,t:0,scroll:e};const c=i.sumWidth(0,n),a=s.sumHeight(0,l,r),d=s.sumHeight(l,o+1,r),u=i.sumWidth(n,h+1);let f=c-e.x,p=a-e.y;const g=this.freezeTotalHeight(),m=this.freezeTotalWidth();return m>0&&m>c&&(f=c),g>0&&g>a&&(p=a),{l:c,t:a,left:f,top:p,height:d,width:u,scroll:e}}getCellRectByXY(t,e){const{scroll:s,merges:i,rows:r,cols:l}=this;let{ri:o,top:h,height:c}=function(t,e){const{rows:s}=this,i=this.freezeTotalHeight();let r=s.height;i+s.height<t&&(r-=e);const l=this.exceptRowSet;let n=0,o=r,{height:h}=s;for(;n<s.len&&!(o>t);n+=1)l.has(n)||(h=s.getHeight(n),o+=h);if((o-=h)<=0)return{ri:-1,top:0,height:h};return{ri:n-1,top:o,height:h}}.call(this,e,s.y),{ci:a,left:d,width:u}=function(t,e){const{cols:s}=this,i=this.freezeTotalWidth();let r=s.indexWidth;i+s.indexWidth<t&&(r-=e);const[l,o,h]=n.rangeReduceIf(0,s.len,r,s.indexWidth,t,t=>s.getWidth(t));if(o<=0)return{ci:-1,left:0,width:s.indexWidth};return{ci:l-1,left:o,width:h}}.call(this,t,s.x);if(-1===a&&(u=l.totalWidth()),-1===o&&(c=r.totalHeight()),o>=0||a>=0){const t=i.getFirstIncludes(o,a);t&&(o=t.sri,a=t.sci,({left:d,top:h,width:u,height:c}=this.cellRect(o,a)))}return{ri:o,ci:a,left:d,top:h,width:u,height:c}}isSignleSelected(){const{sri:t,sci:e,eri:s,eci:i}=this.selector.range,r=this.getCell(t,e);if(r&&r.merge){const[l,n]=r.merge;if(t+l===s&&e+n===i)return!0}return!this.selector.multiple()}canUnmerge(){const{sri:t,sci:e,eri:s,eci:i}=this.selector.range,r=this.getCell(t,e);if(r&&r.merge){const[l,n]=r.merge;if(t+l===s&&e+n===i)return!0}return!1}merge(){const{selector:t,rows:e}=this;if(this.isSignleSelected())return;const[s,i]=t.size();if(s>1||i>1){const{sri:r,sci:l}=t.range;this.changeData(()=>{const n=e.getCellOrNew(r,l);n.merge=[s-1,i-1],this.merges.add(t.range),this.rows.deleteCells(t.range),this.rows.setCell(r,l,n)})}}unmerge(){const{selector:t}=this;if(!this.isSignleSelected())return;const{sri:e,sci:s}=t.range;this.changeData(()=>{this.rows.deleteCell(e,s,"merge"),this.merges.deleteWithin(t.range)})}canAutofilter(){return!this.autoFilter.active()}autofilter(){const{autoFilter:t,selector:e}=this;this.changeData(()=>{t.active()?(t.clear(),this.exceptRowSet=new Set,this.sortedRowMap=new Map,this.unsortedRowMap=new Map):t.ref=e.range.toString()})}setAutoFilter(t,e,s,i){const{autoFilter:r}=this;r.addFilter(t,s,i),r.setSort(t,e),this.resetAutoFilter()}resetAutoFilter(){const{autoFilter:t,rows:e}=this;if(!t.active())return;const{sort:s}=t,{rset:i,fset:r}=t.filteredRows((t,s)=>e.getCell(t,s)),l=Array.from(r),n=Array.from(r);s&&l.sort((t,e)=>"asc"===s.order?t-e:"desc"===s.order?e-t:0),this.exceptRowSet=i,this.sortedRowMap=new Map,this.unsortedRowMap=new Map,l.forEach((t,e)=>{this.sortedRowMap.set(n[e],t),this.unsortedRowMap.set(t,n[e])})}deleteCell(t="all"){const{selector:e}=this;this.changeData(()=>{this.rows.deleteCells(e.range,t),"all"!==t&&"format"!==t||this.merges.deleteWithin(e.range)})}insert(t,e=1){this.changeData(()=>{const{sri:s,sci:i}=this.selector.range,{rows:r,merges:l,cols:n}=this;let o=s;"row"===t?r.insert(s,e):"column"===t&&(r.insertColumn(i,e),o=i,n.len+=1),l.shift(t,o,e,(t,e,s,i)=>{const l=r.getCell(t,e);l.merge[0]+=s,l.merge[1]+=i})})}delete(t){this.changeData(()=>{const{rows:e,merges:s,selector:i,cols:r}=this,{range:l}=i,{sri:n,sci:o,eri:h,eci:c}=i.range,[a,d]=i.range.size();let u=n,f=a;"row"===t?e.delete(n,h):"column"===t&&(e.deleteColumn(o,c),u=l.sci,f=d,r.len-=1),s.shift(t,u,-f,(t,s,i,r)=>{const l=e.getCell(t,s);l.merge[0]+=i,l.merge[1]+=r,0===l.merge[0]&&0===l.merge[1]&&delete l.merge})})}scrollx(t,e){const{scroll:s,freeze:i,cols:r}=this,[,l]=i,[o,h,c]=n.rangeReduceIf(l,r.len,0,0,t,t=>r.getWidth(t));let a=h;t>0&&(a+=c),s.x!==a&&(s.ci=t>0?o:0,s.x=a,e())}scrolly(t,e){const{scroll:s,freeze:i,rows:r}=this,[l]=i,[o,h,c]=n.rangeReduceIf(l,r.len,0,0,t,t=>r.getHeight(t));let a=h;t>0&&(a+=c),s.y!==a&&(s.ri=t>0?o:0,s.y=a,e())}cellRect(t,e){const{rows:s,cols:i}=this,r=i.sumWidth(0,e),l=s.sumHeight(0,t),n=s.getCell(t,e);let o=i.getWidth(e),h=s.getHeight(t);if(null!==n&&n.merge){const[r,l]=n.merge;if(r>0)for(let e=1;e<=r;e+=1)h+=s.getHeight(t+e);if(l>0)for(let t=1;t<=l;t+=1)o+=i.getWidth(e+t)}return{left:r,top:l,width:o,height:h,cell:n}}getCell(t,e){return this.rows.getCell(t,e)}getCellTextOrDefault(t,e){const s=this.getCell(t,e);return s&&s.text?s.text:""}getCellStyle(t,e){const s=this.getCell(t,e);return s&&void 0!==s.style?this.styles[s.style]:null}getCellStyleOrDefault(t,e){const{styles:s,rows:i}=this,r=i.getCell(t,e),l=r&&void 0!==r.style?s[r.style]:{};return n.merge(this.defaultStyle(),l)}getSelectedCellStyle(){const{ri:t,ci:e}=this.selector;return this.getCellStyleOrDefault(t,e)}setCellText(t,e,s,i){const{rows:r,history:l,validations:n}=this;"finished"===i?(r.setCellText(t,e,""),l.add(this.getData()),r.setCellText(t,e,s)):(r.setCellText(t,e,s),this.change(this.getData())),n.validate(t,e,s)}freezeIsActive(){const[t,e]=this.freeze;return t>0||e>0}setFreeze(t,e){this.changeData(()=>{this.freeze=[t,e]})}freezeTotalWidth(){return this.cols.sumWidth(0,this.freeze[1])}freezeTotalHeight(){return this.rows.sumHeight(0,this.freeze[0])}setRowHeight(t,e){this.changeData(()=>{this.rows.setHeight(t,e)})}setColWidth(t,e){this.changeData(()=>{this.cols.setWidth(t,e)})}viewHeight(){const{view:t,showToolbar:e}=this.settings;let s=t.height();return s-=41,e&&(s-=41),s}viewWidth(){return this.settings.view.width()}freezeViewRange(){const[t,e]=this.freeze;return new a.CellRange(0,0,t-1,e-1,this.freezeTotalWidth(),this.freezeTotalHeight())}contentRange(){const{rows:t,cols:e}=this,[s,i]=t.maxCell(),r=t.sumHeight(0,s+1),l=e.sumWidth(0,i+1);return new a.CellRange(0,0,s,i,l,r)}exceptRowTotalHeight(t,e){const{exceptRowSet:s,rows:i}=this,r=Array.from(s);let l=0;return r.forEach(s=>{if(s<t||s>e){const t=i.getHeight(s);l+=t}}),l}viewRange(){const{scroll:t,rows:e,cols:s,freeze:i,exceptRowSet:r}=this;let{ri:l,ci:n}=t;l<=0&&([l]=i),n<=0&&([,n]=i);let[o,h]=[0,0],[c,d]=[e.len,s.len];for(let t=l;t<e.len&&(r.has(t)||(h+=e.getHeight(t),c=t),!(h>this.viewHeight()));t+=1);for(let t=n;t<s.len&&(o+=s.getWidth(t),d=t,!(o>this.viewWidth()));t+=1);return new a.CellRange(l,n,c,d,o,h)}eachMergesInView(t,e){this.merges.filterIntersects(t).forEach(t=>e(t))}hideRowsOrCols(){const{rows:t,cols:e,selector:s}=this,[i,r]=s.size(),{sri:l,sci:n,eri:o,eci:h}=s.range;if(i===t.len)for(let t=n;t<=h;t+=1)e.setHide(t,!0);else if(r===e.len)for(let e=l;e<=o;e+=1)t.setHide(e,!0)}unhideRowsOrCols(t,e){this[`${t}s`].unhide(e)}rowEach(t,e,s){let i=0;const{rows:r}=this,l=this.exceptRowSet,n=[...l];let o=0;for(let e=0;e<n.length;e+=1)n[e]<t&&(o+=1);for(let n=t+o;n<=e+o;n+=1)if(l.has(n))o+=1;else{const t=r.getHeight(n);if(t>0&&(s(n,i,t),(i+=t)>this.viewHeight()))break}}colEach(t,e,s){let i=0;const{cols:r}=this;for(let l=t;l<=e;l+=1){const t=r.getWidth(l);if(t>0&&(s(l,i,t),(i+=t)>this.viewWidth()))break}}defaultStyle(){return this.settings.style}addStyle(t){const{styles:e}=this;for(let s=0;s<e.length;s+=1){const i=e[s];if(n.equals(i,t))return s}return e.push(t),e.length-1}changeData(t){this.history.add(this.getData()),t(),this.change(this.getData())}setData(t){return Object.keys(t).forEach(e=>{if("merges"===e||"rows"===e||"cols"===e||"validations"===e)this[e].setData(t[e]);else if("freeze"===e){const[s,i]=d.expr2xy(t[e]);this.freeze=[i,s]}else"autofilter"===e?this.autoFilter.setData(t[e]):void 0!==t[e]&&(this[e]=t[e])}),this}getData(){const{name:t,freeze:e,styles:s,merges:i,rows:r,cols:l,validations:n,autoFilter:o}=this;return{name:t,freeze:d.xy2expr(e[1],e[0]),styles:s,merges:i.getData(),rows:r.getData(),cols:l.getData(),validations:n.getData(),autofilter:o.getData()}}}}),t("skylark-xspreadsheet/component/event",[],function(){"use strict";function t(t,e,s){t.addEventListener(e,s)}function e(t,e,s){t.removeEventListener(e,s)}function s(t){t.xclickoutside&&(e(window.document.body,"click",t.xclickoutside),delete t.xclickoutside)}function i(t,e,s,i){let r="";Math.abs(t)>Math.abs(e)?i(r=t>0?"right":"left",t,s):i(r=e>0?"down":"up",e,s)}return{bind:t,unbind:e,unbindClickoutside:s,bindClickoutside:function(e,i){e.xclickoutside=(t=>{2===t.detail||e.contains(t.target)||(i?i(e):(e.hide(),s(e)))}),t(window.document.body,"click",e.xclickoutside)},mouseMoveUp:function(s,i,r){t(s,"mousemove",i),s.xEvtUp=(t=>{e(s,"mousemove",i),e(s,"mouseup",s.xEvtUp),r(t)}),t(s,"mouseup",s.xEvtUp)},bindTouch:function(e,{move:s,end:r}){let l=0,n=0;t(e,"touchstart",t=>{const{pageX:e,pageY:s}=t.touches[0];l=e,n=s}),t(e,"touchmove",t=>{if(!s)return;const{pageX:e,pageY:r}=t.changedTouches[0],o=e-l,h=r-n;(Math.abs(o)>10||Math.abs(h)>10)&&(i(o,h,t,s),l=e,n=r),t.preventDefault()}),t(e,"touchend",t=>{if(!r)return;const{pageX:e,pageY:s}=t.changedTouches[0],o=e-l,h=s-n;i(o,h,t,r)})}}}),t("skylark-xspreadsheet/config",[],function(){"use strict";const t=window.devicePixelRatio||1;return{cssPrefix:"x-spreadsheet",dpr:t}}),t("skylark-xspreadsheet/component/resizer",["./element","./event","../config"],function(t,e,s){"use strict";return class{constructor(e=!1,i){this.moving=!1,this.vertical=e,this.el=t.h("div",`${s.cssPrefix}-resizer ${e?"vertical":"horizontal"}`).children(this.unhideHoverEl=t.h("div",`${s.cssPrefix}-resizer-hover`).on("dblclick.stop",t=>this.mousedblclickHandler(t)).css("position","absolute").hide(),this.hoverEl=t.h("div",`${s.cssPrefix}-resizer-hover`).on("mousedown.stop",t=>this.mousedownHandler(t)),this.lineEl=t.h("div",`${s.cssPrefix}-resizer-line`).hide()).hide(),this.cRect=null,this.finishedFn=null,this.minDistance=i,this.unhideFn=(()=>{})}showUnhide(t){this.unhideIndex=t,this.unhideHoverEl.show()}hideUnhide(){this.unhideHoverEl.hide()}show(t,e){const{moving:s,vertical:i,hoverEl:r,lineEl:l,el:n,unhideHoverEl:o}=this;if(s)return;this.cRect=t;const{left:h,top:c,width:a,height:d}=t;n.offset({left:i?h+a-5:h,top:i?c:c+d-5}).show(),r.offset({width:i?5:a,height:i?d:5}),l.offset({width:i?0:e.width,height:i?e.height:0}),o.offset({left:i?5-a:h,top:i?c:5-d,width:i?5:a,height:i?d:5})}hide(){this.el.offset({left:0,top:0}).hide(),this.hideUnhide()}mousedblclickHandler(){this.unhideIndex&&this.unhideFn(this.unhideIndex)}mousedownHandler(t){let s=t;const{el:i,lineEl:r,cRect:l,vertical:n,minDistance:o}=this;let h=n?l.width:l.height;r.show(),e.mouseMoveUp(window,t=>{this.moving=!0,null!==s&&1===t.buttons&&(n?(h+=t.movementX)>o&&i.css("left",`${l.left+h}px`):(h+=t.movementY)>o&&i.css("top",`${l.top+h}px`),s=t)},()=>{s=null,r.hide(),this.moving=!1,this.hide(),this.finishedFn&&(h<o&&(h=o),this.finishedFn(l,h))})}}}),t("skylark-xspreadsheet/component/scrollbar",["./element","../config"],function(t,e){"use strict";return class{constructor(s){this.vertical=s,this.moveFn=null,this.el=t.h("div",`${e.cssPrefix}-scrollbar ${s?"vertical":"horizontal"}`).child(this.contentEl=t.h("div","")).on("mousemove.stop",()=>{}).on("scroll.stop",t=>{const{scrollTop:e,scrollLeft:s}=t.target;this.moveFn&&this.moveFn(this.vertical?e:s,t)})}move(t){return this.el.scroll(t),this}scroll(){return this.el.scroll()}set(t,e){const s=t-1;if(e>s){const t=this.vertical?"height":"width";this.el.css(t,`${s-15}px`).show(),this.contentEl.css(this.vertical?"width":"height","1px").css(t,`${e}px`)}else this.el.hide();return this}}}),t("skylark-xspreadsheet/component/selector",["./element","../config","../core/cell_range"],function(t,e,s){"use strict";const i=3;let r=10;class l{constructor(s=!1){this.useHideInput=s,this.inputChange=(()=>{}),this.cornerEl=t.h("div",`${e.cssPrefix}-selector-corner`),this.areaEl=t.h("div",`${e.cssPrefix}-selector-area`).child(this.cornerEl).hide(),this.clipboardEl=t.h("div",`${e.cssPrefix}-selector-clipboard`).hide(),this.autofillEl=t.h("div",`${e.cssPrefix}-selector-autofill`).hide(),this.el=t.h("div",`${e.cssPrefix}-selector`).css("z-index",`${r}`).children(this.areaEl,this.clipboardEl,this.autofillEl).hide(),s&&(this.hideInput=t.h("input","").on("compositionend",t=>{this.inputChange(t.target.value)}),this.el.child(this.hideInputDiv=t.h("div","hide-input").child(this.hideInput)),this.el.child(this.hideInputDiv=t.h("div","hide-input").child(this.hideInput))),r+=1}setOffset(t){return this.el.offset(t).show(),this}hide(){return this.el.hide(),this}setAreaOffset(t){const{left:e,top:s,width:r,height:l}=t,n={width:r-i+.8,height:l-i+.8,left:e-.8,top:s-.8};this.areaEl.offset(n).show(),this.useHideInput&&(this.hideInputDiv.offset(n),this.hideInput.val("").focus())}setClipboardOffset(t){const{left:e,top:s,width:i,height:r}=t;this.clipboardEl.offset({left:e,top:s,width:i-5,height:r-5})}showAutofill(t){const{left:e,top:s,width:r,height:l}=t;this.autofillEl.offset({width:r-i,height:l-i,left:e,top:s}).show()}hideAutofill(){this.autofillEl.hide()}showClipboard(){this.clipboardEl.show()}hideClipboard(){this.clipboardEl.hide()}}function n(t){const{data:e}=this,{left:s,top:i,width:r,height:l,scroll:n,l:o,t:h}=t,c=e.freezeTotalWidth(),a=e.freezeTotalHeight();let d=s-c;c>o&&(d-=n.x);let u=i-a;return a>h&&(u-=n.y),{left:d,top:u,width:r,height:l}}function o(t){const{data:e}=this,{left:s,width:i,height:r,l:l,t:n,scroll:o}=t,h=e.freezeTotalWidth();let c=s-h;return h>l&&(c-=o.x),{left:c,top:n,width:i,height:r}}function h(t){const{data:e}=this,{top:s,width:i,height:r,l:l,t:n,scroll:o}=t,h=e.freezeTotalHeight();let c=s-h;return h>n&&(c-=o.y),{left:l,top:c,width:i,height:r}}function c(t){const{br:e}=this;e.setAreaOffset(n.call(this,t))}function a(t){const{t:e}=this;e.setAreaOffset(o.call(this,t))}function d(t){const{l:e}=this;e.setAreaOffset(h.call(this,t))}function u(t){const{l:e}=this;e.setClipboardOffset(h.call(this,t))}function f(t){const{br:e}=this;e.setClipboardOffset(n.call(this,t))}function p(t){const{t:e}=this;e.setClipboardOffset(o.call(this,t))}function g(t){c.call(this,t),function(t){const{tl:e}=this;e.setAreaOffset(t)}.call(this,t),a.call(this,t),d.call(this,t)}function m(t){f.call(this,t),function(t){const{tl:e}=this;e.setClipboardOffset(t)}.call(this,t),p.call(this,t),u.call(this,t)}return class{constructor(s){this.inputChange=(()=>{}),this.data=s,this.br=new l(!0),this.t=new l,this.l=new l,this.tl=new l,this.br.inputChange=(t=>{this.inputChange(t)}),this.br.el.show(),this.offset=null,this.areaOffset=null,this.indexes=null,this.range=null,this.arange=null,this.el=t.h("div",`${e.cssPrefix}-selectors`).children(this.tl.el,this.t.el,this.l.el,this.br.el).hide(),this.lastri=-1,this.lastci=-1,r+=1}resetData(t){this.data=t,this.range=t.selector.range,this.resetAreaOffset()}hide(){this.el.hide()}resetOffset(){const{data:t,tl:e,t:s,l:i,br:r}=this,l=t.freezeTotalHeight(),n=t.freezeTotalWidth();l>0||n>0?(e.setOffset({width:n,height:l}),s.setOffset({left:n,height:l}),i.setOffset({top:l,width:n}),r.setOffset({left:n,top:l})):(e.hide(),s.hide(),i.hide(),r.setOffset({left:0,top:0}))}resetAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();g.call(this,t),m.call(this,e),this.resetOffset()}resetBRTAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();c.call(this,t),a.call(this,t),f.call(this,e),p.call(this,e),this.resetOffset()}resetBRLAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();c.call(this,t),d.call(this,t),f.call(this,e),u.call(this,e),this.resetOffset()}set(t,e,s=!0){const{data:i}=this,r=i.calSelectedRangeByStart(t,e),{sri:l,sci:n}=r;if(s){let[s,r]=[t,e];t<0&&(s=0),e<0&&(r=0),i.selector.setIndexes(s,r),this.indexes=[s,r]}this.moveIndexes=[l,n],this.range=r,this.resetAreaOffset(),this.el.show()}setEnd(t,e,s=!0){const{data:i,lastri:r,lastci:l}=this;if(s){if(t===r&&e===l)return;this.lastri=t,this.lastci=e}this.range=i.calSelectedRangeByEnd(t,e),g.call(this,this.data.getSelectedRect())}reset(){const{eri:t,eci:e}=this.data.selector.range;this.setEnd(t,e)}showAutofill(t,e){if(-1===t&&-1===e)return;const{sri:i,sci:r,eri:l,eci:c}=this.range,[a,d]=[t,e],u=i-t,f=r-e,p=l-t,g=c-e;if(f>0)this.arange=new s.CellRange(i,d,l,r-1);else if(u>0)this.arange=new s.CellRange(a,r,i-1,c);else if(g<0)this.arange=new s.CellRange(i,c+1,l,d);else{if(!(p<0))return void(this.arange=null);this.arange=new s.CellRange(l+1,r,a,c)}if(null!==this.arange){const t=this.data.getRect(this.arange);t.width+=2,t.height+=2;const{br:e,l:s,t:i,tl:r}=this;e.showAutofill(n.call(this,t)),s.showAutofill(h.call(this,t)),i.showAutofill(o.call(this,t)),r.showAutofill(t)}}hideAutofill(){["br","l","t","tl"].forEach(t=>{this[t].hideAutofill()})}showClipboard(){const t=this.data.getClipboardRect();m.call(this,t),["br","l","t","tl"].forEach(t=>{this[t].showClipboard()})}hideClipboard(){["br","l","t","tl"].forEach(t=>{this[t].hideClipboard()})}}}),t("skylark-xspreadsheet/component/suggest",["./element","./event","../config"],function(t,e,s){"use strict";function i(t){t.preventDefault();const{filterItems:e}=this;e.length<=0||(t.stopPropagation(),this.itemIndex<0&&(this.itemIndex=0),e[this.itemIndex].el.click(),this.hide())}return class{constructor(e,i,r="200px"){this.filterItems=[],this.items=e,this.el=t.h("div",`${s.cssPrefix}-suggest`).css("width",r).hide(),this.itemClick=i,this.itemIndex=-1}setOffset(t){this.el.cssRemoveKeys("top","bottom").offset(t)}hide(){const{el:t}=this;this.filterItems=[],this.itemIndex=-1,t.hide(),e.unbindClickoutside(this.el.parent())}setItems(t){this.items=t}search(i){let{items:r}=this;if(/^\s*$/.test(i)||(r=r.filter(t=>(t.key||t).startsWith(i.toUpperCase()))),r=r.map(e=>{let{title:i}=e;i?"function"==typeof i&&(i=i()):i=e;const r=t.h("div",`${s.cssPrefix}-item`).child(i).on("click.stop",()=>{this.itemClick(e),this.hide()});return e.label&&r.child(t.h("div","label").html(e.label)),r}),this.filterItems=r,r.length<=0)return;const{el:l}=this;l.html("").children(...r).show(),e.bindClickoutside(l.parent(),()=>{this.hide()})}bindInputEvents(t){t.on("keydown",t=>(function(t){const{keyCode:e}=t;t.ctrlKey&&t.stopPropagation();switch(e){case 37:t.stopPropagation();break;case 38:(function(t){t.preventDefault(),t.stopPropagation();const{filterItems:e}=this;if(e.length<=0)return;this.itemIndex>=0&&e[this.itemIndex].toggle();this.itemIndex-=1,this.itemIndex<0&&(this.itemIndex=e.length-1);e[this.itemIndex].toggle()}).call(this,t);break;case 39:t.stopPropagation();break;case 40:(function(t){t.stopPropagation();const{filterItems:e}=this;if(e.length<=0)return;this.itemIndex>=0&&e[this.itemIndex].toggle();this.itemIndex+=1,this.itemIndex>e.length-1&&(this.itemIndex=0);e[this.itemIndex].toggle()}).call(this,t);break;case 13:case 9:i.call(this,t);break;default:t.stopPropagation()}}).call(this,t))}}}),t("skylark-xspreadsheet/component/icon",["./element","../config"],function(t,e){"use strict";return class extends t.Element{constructor(s){super("div",`${e.cssPrefix}-icon`),this.iconNameEl=t.h("div",`${e.cssPrefix}-icon-img ${s}`),this.child(this.iconNameEl)}setName(t){this.iconNameEl.className(`${e.cssPrefix}-icon-img ${t}`)}}}),t("skylark-xspreadsheet/component/calendar",["./element","./icon","../locale/locale"],function(t,e,s){"use strict";function i(t,e){t.setMonth(t.getMonth()+e)}function r(t,e){const s=new Date(t);return s.setDate(e-t.getDay()+1),s}return class{constructor(i){this.value=i,this.cvalue=new Date(i),this.headerLeftEl=t.h("div","calendar-header-left"),this.bodyEl=t.h("tbody",""),this.buildAll(),this.el=t.h("div","x-spreadsheet-calendar").children(t.h("div","calendar-header").children(this.headerLeftEl,t.h("div","calendar-header-right").children(t.h("m_element","calendar-prev").on("click.stop",()=>this.prev()).child(new e("chevron-left")),t.h("m_element","calendar-next").on("click.stop",()=>this.next()).child(new e("chevron-right")))),t.h("table","calendar-body").children(t.h("thead","").child(t.h("tr","").children(...s.t("calendar.weeks").map(e=>t.h("th","cell").child(e)))),this.bodyEl)),this.selectChange=(()=>{})}setValue(t){this.value=t,this.cvalue=new Date(t),this.buildAll()}prev(){const{value:t}=this;i(t,-1),this.buildAll()}next(){const{value:t}=this;i(t,1),this.buildAll()}buildAll(){this.buildHeaderLeft(),this.buildBody()}buildHeaderLeft(){const{value:t}=this;this.headerLeftEl.html(`${s.t("calendar.months")[t.getMonth()]} ${t.getFullYear()}`)}buildBody(){const{value:e,cvalue:s,bodyEl:i}=this,l=function(t,e,s){const i=new Date(t,e,1,23,59,59),l=[[],[],[],[],[],[]];for(let t=0;t<6;t+=1)for(let n=0;n<7;n+=1){const o=7*t+n,h=r(i,o),c=h.getMonth()!==e,a=h.getMonth()===s.getMonth()&&h.getDate()===s.getDate();l[t][n]={d:h,disabled:c,active:a}}return l}(e.getFullYear(),e.getMonth(),s),n=l.map(e=>{const s=e.map(e=>{let s="cell";return e.disabled&&(s+=" disabled"),e.active&&(s+=" active"),t.h("td","").child(t.h("div",s).on("click.stop",()=>{this.selectChange(e.d)}).child(e.d.getDate().toString()))});return t.h("tr","").children(...s)});i.html("").children(...n)}}}),t("skylark-xspreadsheet/component/datepicker",["./calendar","./element","../config"],function(t,e,s){"use strict";return class{constructor(){this.calendar=new t(new Date),this.el=e.h("div",`${s.cssPrefix}-datepicker`).child(this.calendar.el).hide()}setValue(t){const{calendar:e}=this;return"string"==typeof t?/^\d{4}-\d{1,2}-\d{1,2}$/.test(t)&&e.setValue(new Date(t.replace(new RegExp("-","g"),"/"))):t instanceof Date&&e.setValue(t),this}change(t){this.calendar.selectChange=(e=>{t(e),this.hide()})}show(){this.el.show()}hide(){this.el.hide()}}}),t("skylark-xspreadsheet/component/editor",["./element","./suggest","./datepicker","../config"],function(t,e,s,i){"use strict";function r(){const{inputText:t}=this;if(!/^\s*$/.test(t)){const{textlineEl:e,textEl:s,areaOffset:i}=this,r=t.split("\n"),l=Math.max(...r.map(t=>t.length)),n=e.offset(),o=n.width/t.length,h=(l+1)*o+5,c=this.viewFn().width-i.left-o;let a=r.length;if(h>i.width){let t=h;h>c&&(t=c,a+=parseInt(h/c,10),a+=h%c>0?1:0),s.css("width",`${t}px`)}(a*=this.rowHeight)>i.height&&s.css("height",`${a}px`)}}function l(t){const{keyCode:e,altKey:s}=t;13!==e&&9!==e&&t.stopPropagation(),13===e&&s&&(function({target:t},e){const{value:s,selectionEnd:i}=t,l=`${s.slice(0,i)}${e}${s.slice(i)}`;t.value=l,t.setSelectionRange(i+1,i+1),this.inputText=l,this.textlineEl.html(l),r.call(this)}.call(this,t,"\n"),t.stopPropagation()),13!==e||s||t.preventDefault()}function n(t,e){const{textEl:s,textlineEl:i}=this;s.el.blur(),s.val(t),i.html(t),function(t){const{el:e}=this.textEl;setTimeout(()=>{e.focus(),e.setSelectionRange(t,t)},0)}.call(this,e)}return class{constructor(o,h,c){this.viewFn=h,this.rowHeight=c,this.formulas=o,this.suggest=new e(o,t=>{(function(t){const{inputText:e,validator:s}=this;let i=0;if(s&&"list"===s.type)this.inputText=t,i=this.inputText.length;else{const s=e.lastIndexOf("="),r=e.substring(0,s+1);let l=e.substring(s+1);l=-1!==l.indexOf(")")?l.substring(l.indexOf(")")):"",this.inputText=`${r+t.key}(`,i=this.inputText.length,this.inputText+=`)${l}`}n.call(this,this.inputText,i)}).call(this,t)}),this.datepicker=new s,this.datepicker.change(t=>{this.setText(function(t){let e=t.getMonth()+1,s=t.getDate();e<10&&(e=`0${e}`);s<10&&(s=`0${s}`);return`${t.getFullYear()}-${e}-${s}`}(t)),this.clear()}),this.areaEl=t.h("div",`${i.cssPrefix}-editor-area`).children(this.textEl=t.h("textarea","").on("input",t=>(function(t){const e=t.target.value,{suggest:s,textlineEl:i,validator:l}=this,{cell:n}=this;if(null!==n)if("editable"in n&&!0===n.editable||void 0===n.editable){if(this.inputText=e,l)"list"===l.type?s.search(e):s.hide();else{const t=e.lastIndexOf("=");-1!==t?s.search(e.substring(t+1)):s.hide()}i.html(e),r.call(this),this.change("input",e)}else t.target.value="";else{if(this.inputText=e,l)"list"===l.type?s.search(e):s.hide();else{const t=e.lastIndexOf("=");-1!==t?s.search(e.substring(t+1)):s.hide()}i.html(e),r.call(this),this.change("input",e)}}).call(this,t)).on("paste.stop",()=>{}).on("keydown",t=>l.call(this,t)),this.textlineEl=t.h("div","textline"),this.suggest.el,this.datepicker.el).on("mousemove.stop",()=>{}).on("mousedown.stop",()=>{}),this.el=t.h("div",`${i.cssPrefix}-editor`).child(this.areaEl).hide(),this.suggest.bindInputEvents(this.textEl),this.areaOffset=null,this.freeze={w:0,h:0},this.cell=null,this.inputText="",this.change=(()=>{})}setFreezeLengths(t,e){this.freeze.w=t,this.freeze.undefined=e}clear(){""!==this.inputText&&this.change("finished",this.inputText),this.cell=null,this.areaOffset=null,this.inputText="",this.el.hide(),this.textEl.val(""),this.textlineEl.html(""),function(){this.suggest.setItems(this.formulas)}.call(this),this.datepicker.hide()}setOffset(t,e="top"){const{textEl:s,areaEl:i,suggest:r,freeze:l,el:n}=this;if(t){this.areaOffset=t;const{left:o,top:h,width:c,height:a,l:d,t:u}=t,f={left:0,top:0};l.w>d&&l.undefined>u||(l.w<d&&l.undefined<u?(f.left=l.w,f.top=l.undefined):l.w>d?f.top=l.undefined:l.undefined>u&&(f.left=l.w)),n.offset(f),i.offset({left:o-f.left-.8,top:h-f.top-.8}),s.offset({width:c-9+.8,height:a-3+.8});const p={left:0};p[e]=a,r.setOffset(p),r.hide()}}setCell(t,e){const{el:s,datepicker:i,suggest:r}=this;s.show(),this.cell=t;const l=t&&t.text||"";if(this.setText(l),this.validator=e,e){const{type:t}=e;"date"===t&&(i.show(),/^\s*$/.test(l)||i.setValue(l)),"list"===t&&(r.setItems(e.values()),r.search(""))}}setText(t){this.inputText=t,n.call(this,t,t.length),r.call(this)}}}),t("skylark-xspreadsheet/component/button",["./element","../config","../locale/locale"],function(t,e,s){"use strict";return class extends t.Element{constructor(t,i=""){super("div",`${e.cssPrefix}-button ${i}`),this.child(s.t(`button.${t}`))}}}),t("skylark-xspreadsheet/canvas/draw",[],function(){"use strict";function t(){return window.devicePixelRatio||1}function e(){return t()-.5}function s(e){return parseInt(e*t(),10)}function i(t){const e=s(t);return e>0?e-.5:.5}function r(t,e,s,i,r,l,n){const o={x:0,y:0};"underline"===t?o.y="bottom"===r?0:"top"===r?-(l+2):-l/2:"strike"===t&&("bottom"===r?o.y=l/2:"top"===r&&(o.y=-(l/2+2))),"center"===i?o.x=n/2:"right"===i&&(o.x=n),this.line([e-o.x,s-o.y],[e-o.x+n,s-o.y])}return{Draw:class{constructor(e,s,i){this.el=e,this.ctx=e.getContext("2d"),this.resize(s,i),this.ctx.scale(t(),t())}resize(t,e){this.el.style.width=`${t}px`,this.el.style.height=`${e}px`,this.el.width=s(t),this.el.height=s(e)}clear(){const{width:t,height:e}=this.el;return this.ctx.clearRect(0,0,t,e),this}attr(t){return Object.assign(this.ctx,t),this}save(){return this.ctx.save(),this.ctx.beginPath(),this}restore(){return this.ctx.restore(),this}beginPath(){return this.ctx.beginPath(),this}translate(t,e){return this.ctx.translate(s(t),s(e)),this}scale(t,e){return this.ctx.scale(t,e),this}clearRect(t,e,s,i){return this.ctx.clearRect(t,e,s,i),this}fillRect(t,e,i,r){return this.ctx.fillRect(s(t)-.5,s(e)-.5,s(i),s(r)),this}fillText(t,e,i){return this.ctx.fillText(t,s(e),s(i)),this}text(t,e,i={},l=!0){const{ctx:n}=this,{align:o,valign:h,font:c,color:a,strike:d,underline:u}=i,f=e.textx(o);n.save(),n.beginPath(),this.attr({textAlign:o,textBaseline:h,font:`${c.italic?"italic":""} ${c.bold?"bold":""} ${s(c.size)}px ${c.name}`,fillStyle:a,strokeStyle:a});const p=`${t}`.split("\n"),g=e.innerWidth(),m=[];p.forEach(t=>{const e=n.measureText(t).width;if(l&&e>s(g)){let e={w:0,len:0,start:0};for(let i=0;i<t.length;i+=1)e.w>=s(g)&&(m.push(t.substr(e.start,e.len)),e={w:0,len:0,start:i}),e.len+=1,e.w+=n.measureText(t[i]).width+1;e.len>0&&m.push(t.substr(e.start,e.len))}else m.push(t)});const w=(m.length-1)*(c.size+2);let x=e.texty(h,w);return m.forEach(t=>{const e=n.measureText(t).width;this.fillText(t,f,x),d&&r.call(this,"strike",f,x,o,h,c.size,e),u&&r.call(this,"underline",f,x,o,h,c.size,e),x+=c.size+2}),n.restore(),this}border(t,i){const{ctx:r}=this;return r.lineWidth=e,r.strokeStyle=i,"medium"===t?r.lineWidth=s(2)-.5:"thick"===t?r.lineWidth=s(3):"dashed"===t?r.setLineDash([s(3),s(2)]):"dotted"===t?r.setLineDash([s(1),s(1)]):"double"===t&&r.setLineDash([s(2),0]),this}line(...t){const{ctx:e}=this;if(t.length>1){e.beginPath();const[s,r]=t[0];e.moveTo(i(s),i(r));for(let s=1;s<t.length;s+=1){const[r,l]=t[s];e.lineTo(i(r),i(l))}e.stroke()}return this}strokeBorders(t){const{ctx:e}=this;e.save();const{borderTop:s,borderRight:i,borderBottom:r,borderLeft:l}=t;s&&(this.border(...s),this.line(...t.topxys())),i&&(this.border(...i),this.line(...t.rightxys())),r&&(this.border(...r),this.line(...t.bottomxys())),l&&(this.border(...l),this.line(...t.leftxys())),e.restore()}dropdown(t){const{ctx:e}=this,{x:i,y:r,width:l,height:n}=t,o=i+l-15,h=r+n-15;e.save(),e.beginPath(),e.moveTo(s(o),s(h)),e.lineTo(s(o+8),s(h)),e.lineTo(s(o+4),s(h+6)),e.closePath(),e.fillStyle="rgba(0, 0, 0, .45)",e.fill(),e.restore()}error(t){const{ctx:e}=this,{x:i,y:r,width:l}=t,n=i+l-1;e.save(),e.beginPath(),e.moveTo(s(n-8),s(r-1)),e.lineTo(s(n),s(r-1)),e.lineTo(s(n),s(r+8)),e.closePath(),e.fillStyle="rgba(255, 0, 0, .65)",e.fill(),e.restore()}frozen(t){const{ctx:e}=this,{x:i,y:r,width:l}=t,n=i+l-1;e.save(),e.beginPath(),e.moveTo(s(n-8),s(r-1)),e.lineTo(s(n),s(r-1)),e.lineTo(s(n),s(r+8)),e.closePath(),e.fillStyle="rgba(0, 255, 0, .85)",e.fill(),e.restore()}rect(t,e){const{ctx:r}=this,{x:l,y:n,width:o,height:h,bgcolor:c}=t;r.save(),r.beginPath(),r.fillStyle=c||"#fff",r.rect(i(l+1),i(n+1),s(o-2),s(h-2)),r.clip(),r.fill(),e(),r.restore()}},DrawBox:class{constructor(t,e,s,i,r=0){this.x=t,this.y=e,this.width=s,this.height=i,this.padding=r,this.bgcolor="#ffffff",this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null}setBorders({top:t,bottom:e,left:s,right:i}){t&&(this.borderTop=t),i&&(this.borderRight=i),e&&(this.borderBottom=e),s&&(this.borderLeft=s)}innerWidth(){return this.width-2*this.padding-2}innerHeight(){return this.height-2*this.padding-2}textx(t){const{width:e,padding:s}=this;let{x:i}=this;return"left"===t?i+=s:"center"===t?i+=e/2:"right"===t&&(i+=e-s),i}texty(t,e){const{height:s,padding:i}=this;let{y:r}=this;return"top"===t?r+=i:"middle"===t?r+=s/2-e/2:"bottom"===t&&(r+=s-i-e),r}topxys(){const{x:t,y:e,width:s}=this;return[[t,e],[t+s,e]]}rightxys(){const{x:t,y:e,width:s,height:i}=this;return[[t+s,e],[t+s,e+i]]}bottomxys(){const{x:t,y:e,width:s,height:i}=this;return[[t,e+i],[t+s,e+i]]}leftxys(){const{x:t,y:e,height:s}=this;return[[t,e],[t,e+s]]}},thinLineWidth:e,npx:s}}),t("skylark-xspreadsheet/core/font",[],function(){"use strict";const t=[{key:"Arial",title:"Arial"},{key:"Helvetica",title:"Helvetica"},{key:"Source Sans Pro",title:"Source Sans Pro"},{key:"Comic Sans MS",title:"Comic Sans MS"},{key:"Courier New",title:"Courier New"},{key:"Verdana",title:"Verdana"},{key:"Lato",title:"Lato"}],e=[{pt:7.5,px:10},{pt:8,px:11},{pt:9,px:12},{pt:10,px:13},{pt:10.5,px:14},{pt:11,px:15},{pt:12,px:16},{pt:14,px:18.7},{pt:15,px:20},{pt:16,px:21.3},{pt:18,px:24},{pt:22,px:29.3},{pt:24,px:32},{pt:26,px:34.7},{pt:36,px:48},{pt:42,px:56}];return{fontSizes:e,fonts:function(e=[]){const s={};return t.concat(e).forEach(t=>{s[t.key]=t}),s},baseFonts:t,getFontSizePxByPt:function(t){for(let s=0;s<e.length;s+=1){const i=e[s];if(i.pt===t)return i.px}return t}}}),t("skylark-xspreadsheet/core/cell",["./alphabet","./helper"],function(t,e){"use strict";const s=e=>{const s=[],i=[];let r=[],l=0,n="",o=1,h="";for(let c=0;c<e.length;c+=1){const a=e.charAt(c);if(" "!==a){if(a>="a"&&a<="z")r.push(a.toUpperCase());else if(a>="0"&&a<="9"||a>="A"&&a<="Z"||"."===a)r.push(a);else if('"'===a){for(c+=1;'"'!==e.charAt(c);)r.push(e.charAt(c)),c+=1;i.push(`"${r.join("")}`),r=[]}else if("-"===a&&/[+\-*/,(]/.test(h))r.push(a);else{if("("!==a&&r.length>0&&i.push(r.join("")),")"===a){let e=s.pop();if(2===l)try{const[s,r]=t.expr2xy(i.pop()),[l,n]=t.expr2xy(i.pop());let o=0;for(let e=l;e<=s;e+=1)for(let s=n;s<=r;s+=1)i.push(t.xy2expr(e,s)),o+=1;i.push([e,o])}catch(t){}else if(1===l||3===l)3===l&&i.push(n),i.push([e,o]),o=1;else for(;"("!==e&&(i.push(e),!(s.length<=0));)e=s.pop();l=0}else if("="===a||">"===a||"<"===a){const t=e.charAt(c+1);n=a,"="!==t&&"-"!==t||(n+=t,c+=1),l=3}else if(":"===a)l=2;else if(","===a)3===l&&i.push(n),l=1,o+=1;else if("("===a&&r.length>0)s.push(r.join(""));else{if(s.length>0&&("+"===a||"-"===a)){let t=s[s.length-1];if("("!==t&&i.push(s.pop()),"*"===t||"/"===t)for(;s.length>0&&"("!==(t=s[s.length-1]);)i.push(s.pop())}else if(s.length>0){const t=s[s.length-1];"*"!==t&&"/"!==t||i.push(s.pop())}s.push(a)}r=[]}h=a}}for(r.length>0&&i.push(r.join(""));s.length>0;)i.push(s.pop());return i},i=(e,s)=>{const[i]=e;let r=e;if('"'===i)return e.substring(1);let l=1;if("-"===i&&(r=e.substring(1),l=-1),r[0]>="0"&&r[0]<="9")return l*Number(r);const[n,o]=t.expr2xy(r);return l*s(n,o)},r=(t,l,n,o=[])=>{if("="===t[0]){const h=s(t.substring(1));return h.length<=0?t:((t,s,r,l)=>{const n=[];for(let o=0;o<t.length;o+=1){const h=t[o],c=h[0];if("+"===h){const t=n.pop();n.push(e.numberCalc("+",n.pop(),t))}else if("-"===h)if(1===n.length){const t=n.pop();n.push(e.numberCalc("*",t,-1))}else{const t=n.pop();n.push(e.numberCalc("-",n.pop(),t))}else if("*"===h)n.push(e.numberCalc("*",n.pop(),n.pop()));else if("/"===h){const t=n.pop();n.push(e.numberCalc("/",n.pop(),t))}else if("="===c||">"===c||"<"===c){let t=n.pop();Number.isNaN(t)||(t=Number(t));let e=n.pop();Number.isNaN(e)||(e=Number(e));let s=!1;"="===c?s=e===t:">"===h?s=e>t:">="===h?s=e>=t:"<"===h?s=e<t:"<="===h&&(s=e<=t),n.push(s)}else if(Array.isArray(h)){const[t,e]=h,i=[];for(let t=0;t<e;t+=1)i.push(n.pop());n.push(s[t].render(i.reverse()))}else{if(l.includes(h))return 0;(c>="a"&&c<="z"||c>="A"&&c<="Z")&&l.push(h),n.push(i(h,r)),l.pop()}}return n[0]})(h,l,(t,e)=>r(n(t,e),l,n,o),o)}return t};return{render:r,infixExprToSuffixExpr:s}}),t("skylark-xspreadsheet/core/formula",["../locale/locale","./helper"],function(t,e){"use strict";const s=[{key:"SUM",title:t.tf("formula.sum"),render:t=>t.reduce((t,s)=>e.numberCalc("+",t,s),0)},{key:"AVERAGE",title:t.tf("formula.average"),render:t=>t.reduce((t,e)=>Number(t)+Number(e),0)/t.length},{key:"MAX",title:t.tf("formula.max"),render:t=>Math.max(...t.map(t=>Number(t)))},{key:"MIN",title:t.tf("formula.min"),render:t=>Math.min(...t.map(t=>Number(t)))},{key:"IF",title:t.tf("formula._if"),render:([t,e,s])=>t?e:s},{key:"AND",title:t.tf("formula.and"),render:t=>t.every(t=>t)},{key:"OR",title:t.tf("formula.or"),render:t=>t.some(t=>t)},{key:"CONCAT",title:t.tf("formula.concat"),render:t=>t.join("")}],i=s,r={};return s.forEach(t=>{r[t.key]=t}),{formulam:r,formulas:i,baseFormulas:s}}),t("skylark-xspreadsheet/core/format",["../locale/locale"],function(t){"use strict";const e=t=>t,s=t=>{if(/^(-?\d*.?\d*)$/.test(t)){const e=Number(t).toFixed(2).toString(),[s,...i]=e.split("\\.");return[s.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),...i]}return t},i=[{key:"normal",title:t.tf("format.normal"),type:"string",render:e},{key:"text",title:t.tf("format.text"),type:"string",render:e},{key:"number",title:t.tf("format.number"),type:"number",label:"1,000.12",render:s},{key:"percent",title:t.tf("format.percent"),type:"number",label:"10.12%",render:t=>`${t}%`},{key:"rmb",title:t.tf("format.rmb"),type:"number",label:"￥10.00",render:t=>`￥${s(t)}`},{key:"usd",title:t.tf("format.usd"),type:"number",label:"$10.00",render:t=>`$${s(t)}`},{key:"eur",title:t.tf("format.eur"),type:"number",label:"€10.00",render:t=>`€${s(t)}`},{key:"date",title:t.tf("format.date"),type:"date",label:"26/09/2008",render:e},{key:"time",title:t.tf("format.time"),type:"date",label:"15:59:00",render:e},{key:"datetime",title:t.tf("format.datetime"),type:"date",label:"26/09/2008 15:59:00",render:e},{key:"duration",title:t.tf("format.duration"),type:"date",label:"24:01:00",render:e}],r={};return i.forEach(t=>{r[t.key]=t}),{formatm:r,baseFormats:i}}),t("skylark-xspreadsheet/component/table",["../core/alphabet","../core/font","../core/cell","../core/formula","../core/format","../canvas/draw"],function(t,e,s,i,r,l){"use strict";const n=5,o={fillStyle:"#f4f5f8"},h={fillStyle:"#fff",lineWidth:l.thinLineWidth,strokeStyle:"#e6e6e6"};function c(t,e,s,i=0){const{left:r,top:o,width:h,height:c}=t.cellRect(e,s);return new l.DrawBox(r,o+i,h,c,n)}function a(t,l,n,o,h=0){const{sortedRowMap:a,rows:d,cols:u}=l;if(d.isHide(n)||u.isHide(o))return;let f=n;a.has(n)&&(f=a.get(n));const p=l.getCell(f,o);if(null===p)return;let g=!1;"editable"in p&&!1===p.editable&&(g=!0);const m=l.getCellStyleOrDefault(f,o),w=c(l,n,o,h);w.bgcolor=m.bgcolor,void 0!==m.border&&(w.setBorders(m.border),t.strokeBorders(w)),t.rect(w,()=>{let h=s.render(p.text||"",i.formulam,(t,e)=>l.getCellTextOrDefault(e,t));m.format&&(h=r.formatm[m.format].render(h));const c=Object.assign({},m.font);c.size=e.getFontSizePxByPt(c.size),t.text(h,w,{align:m.align,valign:m.valign,font:c,color:m.color,strike:m.strike,underline:m.underline},m.textwrap);const a=l.validations.getError(n,o);a&&t.error(w),g&&t.frozen(w)})}function d(t,e,s,i,r){const{draw:l,data:n}=this;l.save(),l.translate(e,s).translate(i,r);const{exceptRowSet:o}=n,h=n.exceptRowTotalHeight(t.sri,t.eri);l.save(),l.translate(0,-h),t.each((t,e)=>{a(l,n,t,e)},t=>(t=>{const e=o.has(t);if(e){const e=n.rows.getHeight(t);l.translate(0,-e)}return!e})(t)),l.restore();const d=new Set;l.save(),l.translate(0,-h),n.eachMergesInView(t,({sri:t,sci:e,eri:s})=>{if(o.has(t)){if(!d.has(t)){d.add(t);const e=n.rows.sumHeight(t,s+1);l.translate(0,-e)}}else a(l,n,t,e)}),l.restore(),function(t){const{data:e,draw:s}=this;if(t){const{autoFilter:i}=e;if(!i.active())return;const r=i.hrange();t.intersects(r)&&r.each((t,i)=>{const r=c(e,t,i);s.dropdown(r)})}}.call(this,t),l.restore()}function u(t,e,s,i){const{draw:r}=this;r.save(),r.attr({fillStyle:"rgba(75, 137, 255, 0.08)"}).fillRect(t,e,s,i),r.restore()}function f(e,s,i,r,n,h){const{draw:c,data:a}=this,d=s.h,f=s.w,p=h+r,g=n+i;c.save(),c.attr(o),"all"!==e&&"left"!==e||c.fillRect(0,p,i,d),"all"!==e&&"top"!==e||c.fillRect(g,0,f,r);const{sri:m,sci:w,eri:x,eci:b}=a.selector.range;c.attr({textAlign:"center",textBaseline:"middle",font:`500 ${l.npx(12)}px Source Sans Pro`,fillStyle:"#585757",lineWidth:l.thinLineWidth(),strokeStyle:"#e6e6e6"}),"all"!==e&&"left"!==e||(a.rowEach(s.sri,s.eri,(t,e,s)=>{const r=p+e,l=t;c.line([0,r],[i,r]),m<=l&&l<x+1&&u.call(this,0,r,i,s),c.fillText(l+1,i/2,r+s/2),t>0&&a.rows.isHide(t-1)&&(c.save(),c.attr({strokeStyle:"#c6c6c6"}),c.line([5,r+5],[i-5,r+5]),c.restore())}),c.line([0,d+p],[i,d+p]),c.line([i,p],[i,d+p])),"all"!==e&&"top"!==e||(a.colEach(s.sci,s.eci,(e,s,i)=>{const l=g+s,n=e;c.line([l,0],[l,r]),w<=n&&n<b+1&&u.call(this,l,0,i,r),c.fillText(t.stringAt(n),l+i/2,r/2),e>0&&a.cols.isHide(e-1)&&(c.save(),c.attr({strokeStyle:"#c6c6c6"}),c.line([l+5,5],[l+5,r-5]),c.restore())}),c.line([f+g,0],[f+g,r]),c.line([0,r],[f+g,r])),c.restore()}function p({sri:t,sci:e,eri:s,eci:i,w:r,h:l},n,o,c,a){const{draw:d,data:u}=this,{settings:f}=u;d.save(),d.attr(h).translate(n+c,o+a),d.clearRect(0,0,r,l),f.showGrid?(u.rowEach(t,s,(e,i,l)=>{e!==t&&d.line([0,i],[r,i]),e===s&&d.line([0,i+l],[r,i+l])}),u.colEach(e,i,(t,s,r)=>{t!==e&&d.line([s,0],[s,l]),t===i&&d.line([s+r,0],[s+r,l])}),d.restore()):d.restore()}return{renderCell:a,Table:class{constructor(t,e){this.el=t,this.draw=new l.Draw(t,e.viewWidth(),e.viewHeight()),this.data=e}resetData(t){this.data=t,this.render()}render(){const{data:t}=this,{rows:e,cols:s}=t,i=s.indexWidth,r=e.height;this.draw.resize(t.viewWidth(),t.viewHeight()),this.clear();const l=t.viewRange(),n=t.freezeTotalWidth(),o=t.freezeTotalHeight(),{x:h,y:c}=t.scroll;p.call(this,l,i,r,n,o),d.call(this,l,i,r,-h,-c),f.call(this,"all",l,i,r,n,o),function(t,e){const{draw:s}=this;s.save(),s.attr({fillStyle:"#f4f5f8"}).fillRect(0,0,t,e),s.restore()}.call(this,i,r);const[a,u]=t.freeze;if(a>0||u>0){if(a>0){const t=l.clone();t.sri=0,t.eri=a-1,t.h=o,p.call(this,t,i,r,n,0),d.call(this,t,i,r,-h,0),f.call(this,"top",t,i,r,n,0)}if(u>0){const t=l.clone();t.sci=0,t.eci=u-1,t.w=n,p.call(this,t,i,r,0,o),f.call(this,"left",t,i,r,0,o),d.call(this,t,i,r,0,-c)}const e=t.freezeViewRange();p.call(this,e,i,r,0,0),f.call(this,"all",e,i,r,0,0),d.call(this,e,i,r,0,0),function(t,e,s,i){const{draw:r,data:l}=this,n=l.viewWidth()-t,o=l.viewHeight()-e;r.save().translate(t,e).attr({strokeStyle:"rgba(75, 137, 255, .6)"}),r.line([0,i],[n,i]),r.line([s,0],[s,o]),r.restore()}.call(this,i,r,n,o)}}clear(){this.draw.clear()}}}}),t("skylark-xspreadsheet/component/print",["./element","../config","./button","../canvas/draw","./table","../locale/locale"],function(t,e,s,i,r,l){"use strict";const n=[["A3",11.69,16.54],["A4",8.27,11.69],["A5",5.83,8.27],["B4",9.84,13.9],["B5",6.93,9.84]],o=["landscape","portrait"];function h(t){return parseInt(96*t,10)}function c(t){"cancel"===t?this.el.hide():this.toPrint()}return class{constructor(i){this.paper={w:h(n[0][1]),h:h(n[0][2]),padding:50,orientation:o[0],get width(){return"landscape"===this.orientation?this.undefined:this.w},get height(){return"landscape"===this.orientation?this.w:this.undefined}},this.data=i,this.el=t.h("div",`${e.cssPrefix}-print`).children(t.h("div",`${e.cssPrefix}-print-bar`).children(t.h("div","-title").child("Print settings"),t.h("div","-right").children(t.h("div",`${e.cssPrefix}-buttons`).children(new s("cancel").on("click",c.bind(this,"cancel")),new s("next","primary").on("click",c.bind(this,"next"))))),t.h("div",`${e.cssPrefix}-print-content`).children(this.contentEl=t.h("div","-content"),t.h("div","-sider").child(t.h("form","").children(t.h("fieldset","").children(t.h("label","").child(`${l.t("print.size")}`),t.h("select","").children(...n.map((e,s)=>t.h("option","").attr("value",s).child(`${e[0]} ( ${e[1]}''x${e[2]}'' )`))).on("change",function(t){const{paper:e}=this,{value:s}=t.target,i=n[s];e.w=h(i[1]),e.undefined=h(i[2]),this.preview()}.bind(this))),t.h("fieldset","").children(t.h("label","").child(`${l.t("print.orientation")}`),t.h("select","").children(...o.map((e,s)=>t.h("option","").attr("value",s).child(`${l.t("print.orientations")[s]}`))).on("change",function(t){const{paper:e}=this,{value:s}=t.target,i=o[s];e.orientation=i,this.preview()}.bind(this))))))).hide()}resetData(t){this.data=t}preview(){const{data:s,paper:l}=this,{width:n,height:o,padding:h}=l,c=n-2*h,a=o-2*h,d=s.contentRange(),u=parseInt(d.undefined/a,10)+1,f=c/d.w;let p=h;const g=h;f>1&&(p+=(c-d.w)/2);let m=0,w=0;this.contentEl.html(""),this.canvases=[];const x={sri:0,sci:0,eri:0,eci:0};for(let l=0;l<u;l+=1){let l=0,h=0;const c=t.h("div",`${e.cssPrefix}-canvas-card`),u=t.h("canvas",`${e.cssPrefix}-canvas`);this.canvases.push(u.el);const b=new i.Draw(u.el,n,o);for(b.save(),b.translate(p,g),f<1&&b.scale(f,f);m<=d.eri;m+=1){const t=s.rows.getHeight(m);if(!((l+=t)<a)){h=-(l-t);break}for(let t=0;t<=d.eci;t+=1)r.renderCell(b,s,m,t,w),x.eci=t}x.eri=m,b.restore(),b.save(),b.translate(p,g),f<1&&b.scale(f,f);const v=w;s.eachMergesInView(x,({sri:t,sci:e})=>{r.renderCell(b,s,t,e,v)}),b.restore(),x.sri=x.eri,x.sci=x.eci,w+=h,this.contentEl.child(t.h("div",`${e.cssPrefix}-canvas-card-wraper`).child(c.child(u)))}this.el.show()}toPrint(){this.el.hide();const{paper:e}=this,s=t.h("iframe","").hide(),{el:i}=s;window.document.body.appendChild(i);const{contentWindow:r}=i,l=r.document,n=document.createElement("style");n.innerHTML=`\n      @page { size: ${e.width}px ${e.height}px; };\n      canvas {\n        page-break-before: auto;        \n        page-break-after: always;\n        image-rendering: pixelated;\n      };\n    `,l.head.appendChild(n),this.canvases.forEach(t=>{const e=t.cloneNode(!1),s=e.getContext("2d");s.drawImage(t,0,0),l.body.appendChild(e)}),r.print()}}}),t("skylark-xspreadsheet/component/contextmenu",["./element","./event","../config","../locale/locale"],function(t,e,s,i){"use strict";const r=[{key:"copy",title:i.tf("contextmenu.copy"),label:"Ctrl+C"},{key:"cut",title:i.tf("contextmenu.cut"),label:"Ctrl+X"},{key:"paste",title:i.tf("contextmenu.paste"),label:"Ctrl+V"},{key:"paste-value",title:i.tf("contextmenu.pasteValue"),label:"Ctrl+Shift+V"},{key:"paste-format",title:i.tf("contextmenu.pasteFormat"),label:"Ctrl+Alt+V"},{key:"divider"},{key:"insert-row",title:i.tf("contextmenu.insertRow")},{key:"insert-column",title:i.tf("contextmenu.insertColumn")},{key:"divider"},{key:"delete-row",title:i.tf("contextmenu.deleteRow")},{key:"delete-column",title:i.tf("contextmenu.deleteColumn")},{key:"delete-cell-text",title:i.tf("contextmenu.deleteCellText")},{key:"hide",title:i.tf("contextmenu.hide")},{key:"divider"},{key:"validation",title:i.tf("contextmenu.validation")},{key:"divider"},{key:"cell-printable",title:i.tf("contextmenu.cellprintable")},{key:"cell-non-printable",title:i.tf("contextmenu.cellnonprintable")},{key:"divider"},{key:"cell-editable",title:i.tf("contextmenu.celleditable")},{key:"cell-non-editable",title:i.tf("contextmenu.cellnoneditable")}];function l(){return r.map(e=>(function(e){if("divider"===e.key)return t.h("div",`${s.cssPrefix}-item divider`);return t.h("div",`${s.cssPrefix}-item`).on("click",()=>{this.itemClick(e.key),this.hide()}).children(e.title(),t.h("div","label").child(e.label||""))}).call(this,e))}return class{constructor(e,i=!1){this.menuItems=l.call(this),this.el=t.h("div",`${s.cssPrefix}-contextmenu`).children(...this.menuItems).hide(),this.viewFn=e,this.itemClick=(()=>{}),this.isHide=i,this.setMode("range")}setMode(t){const e=this.menuItems[12];"row-col"===t?e.show():e.hide()}hide(){const{el:t}=this;t.hide(),e.unbindClickoutside(t)}setPosition(t,s){if(this.isHide)return;const{el:i}=this,{width:r}=i.show().offset(),l=this.viewFn(),n=l.height/2;let o=t;l.width-t<=r&&(o-=r),i.css("left",`${o}px`),s>n?i.css("bottom",`${l.height-s}px`).css("max-height",`${s}px`).css("top","auto"):i.css("top",`${s}px`).css("max-height",`${l.height-s}px`).css("bottom","auto"),e.bindClickoutside(i)}}}),t("skylark-xspreadsheet/component/tooltip",["./element","./event","../config"],function(t,e,s){"use strict";return function(i,r){if(r.classList.contains("active"))return;const{left:l,top:n,width:o,height:h}=r.getBoundingClientRect(),c=t.h("div",`${s.cssPrefix}-tooltip`).html(i).show();document.body.appendChild(c.el);const a=c.box();c.css("left",`${l+o/2-a.width/2}px`).css("top",`${n+h+2}px`),e.bind(r,"mouseleave",()=>{document.body.contains(c.el)&&document.body.removeChild(c.el)}),e.bind(r,"click",()=>{document.body.contains(c.el)&&document.body.removeChild(c.el)})}}),t("skylark-xspreadsheet/component/toolbar/item",["../../config","../tooltip","../element","../../locale/locale"],function(t,e,s,i){"use strict";return class{constructor(t,e,s){this.tip=i.t(`toolbar.${t.replace(/-[a-z]/g,t=>t[1].toUpperCase())}`),e&&(this.tip+=` (${e})`),this.tag=t,this.shortcut=e,this.value=s,this.el=this.element(),this.change=(()=>{})}element(){const{tip:i}=this;return s.h("div",`${t.cssPrefix}-toolbar-btn`).on("mouseenter",t=>{e(i,t.target)}).attr("data-tooltip",i)}setState(){}}}),t("skylark-xspreadsheet/component/toolbar/dropdown_item",["./item"],function(t){"use strict";return class extends t{dropdown(){}getValue(t){return t}element(){const{tag:t}=this;return this.dd=this.dropdown(),this.dd.change=(e=>this.change(t,this.getValue(e))),super.element().child(this.dd)}setState(t){t&&(this.value=t,this.dd.setTitle(t))}}}),t("skylark-xspreadsheet/component/dropdown",["./element","./event","../config"],function(t,e,s){"use strict";return class extends t.Element{constructor(e,i,r,l,...n){super("div",`${s.cssPrefix}-dropdown ${l}`),this.title=e,this.change=(()=>{}),this.headerClick=(()=>{}),"string"==typeof e?this.title=t.h("div",`${s.cssPrefix}-dropdown-title`).child(e):r&&this.title.addClass("arrow-left"),this.contentEl=t.h("div",`${s.cssPrefix}-dropdown-content`).css("width",i).hide(),this.setContentChildren(...n),this.headerEl=t.h("div",`${s.cssPrefix}-dropdown-header`),this.headerEl.on("click",()=>{"block"!==this.contentEl.css("display")?this.show():this.hide()}).children(this.title,r?t.h("div",`${s.cssPrefix}-icon arrow-right`).child(t.h("div",`${s.cssPrefix}-icon-img arrow-down`)):""),this.children(this.headerEl,this.contentEl)}setContentChildren(...t){this.contentEl.html(""),t.length>0&&this.contentEl.children(...t)}setTitle(t){this.title.html(t),this.hide()}show(){const{contentEl:t}=this;t.show(),this.parent().active(),e.bindClickoutside(this.parent(),()=>{this.hide()})}hide(){this.parent().active(!1),this.contentEl.hide(),e.unbindClickoutside(this.parent())}}}),t("skylark-xspreadsheet/component/dropdown_align",["./dropdown","./element","./icon","../config"],function(t,e,s,i){"use strict";return class extends t{constructor(t,r){const l=new s(`align-${r}`),n=t.map(t=>(o=`align-${t}`,e.h("div",`${i.cssPrefix}-item`).child(new s(o))).on("click",()=>{this.setTitle(t),this.change(t)}));var o;super(l,"auto",!0,"bottom-left",...n)}setTitle(t){this.title.setName(`align-${t}`),this.hide()}}}),t("skylark-xspreadsheet/component/toolbar/align",["./dropdown_item","../dropdown_align"],function(t,e){"use strict";return class extends t{constructor(t){super("align","",t)}dropdown(){const{value:t}=this;return new e(["left","center","right"],t)}}}),t("skylark-xspreadsheet/component/toolbar/valign",["./dropdown_item","../dropdown_align"],function(t,e){"use strict";return class extends t{constructor(t){super("valign","",t)}dropdown(){const{value:t}=this;return new e(["top","middle","bottom"],t)}}}),t("skylark-xspreadsheet/component/toolbar/toggle_item",["./item","../icon"],function(t,e){"use strict";return class extends t{element(){const{tag:t}=this;return super.element().child(new e(t)).on("click",()=>this.click())}click(){this.change(this.tag,this.toggle())}setState(t){this.el.active(t)}toggle(){return this.el.toggle()}active(){return this.el.hasClass("active")}}}),t("skylark-xspreadsheet/component/toolbar/autofilter",["./toggle_item"],function(t){"use strict";return class extends t{constructor(){super("autofilter")}setState(){}}}),t("skylark-xspreadsheet/component/toolbar/bold",["./toggle_item"],function(t){"use strict";return class extends t{constructor(){super("font-bold","Ctrl+B")}}}),t("skylark-xspreadsheet/component/toolbar/italic",["./toggle_item"],function(t){"use strict";return class extends t{constructor(){super("font-italic","Ctrl+I")}}}),t("skylark-xspreadsheet/component/toolbar/strike",["./toggle_item"],function(t){"use strict";return class extends t{constructor(){super("strike","Ctrl+U")}}}),t("skylark-xspreadsheet/component/toolbar/underline",["./toggle_item"],function(t){"use strict";return class extends t{constructor(){super("underline","Ctrl+U")}}}),t("skylark-xspreadsheet/component/color_palette",["./element","../config"],function(t,e){"use strict";const s=["#ffffff","#000100","#e7e5e6","#445569","#5b9cd6","#ed7d31","#a5a5a5","#ffc001","#4371c6","#71ae47"],i=[["#f2f2f2","#7f7f7f","#d0cecf","#d5dce4","#deeaf6","#fce5d5","#ededed","#fff2cd","#d9e2f3","#e3efd9"],["#d8d8d8","#595959","#afabac","#adb8ca","#bdd7ee","#f7ccac","#dbdbdb","#ffe59a","#b3c6e7","#c5e0b3"],["#bfbfbf","#3f3f3f","#756f6f","#8596b0","#9cc2e6","#f4b184","#c9c9c9","#fed964","#8eaada","#a7d08c"],["#a5a5a5","#262626","#3a3839","#333f4f","#2e75b5","#c45a10","#7b7b7b","#bf8e01","#2f5596","#538136"],["#7f7f7f","#0c0c0c","#171516","#222a35","#1f4e7a","#843c0a","#525252","#7e6000","#203864","#365624"]],r=["#c00000","#fe0000","#fdc101","#ffff01","#93d051","#00b04e","#01b0f1","#0170c1","#012060","#7030a0"];function l(s){return t.h("td","").child(t.h("div",`${e.cssPrefix}-color-palette-cell`).on("click.stop",()=>this.change(s)).css("background-color",s))}return class{constructor(){this.el=t.h("div",`${e.cssPrefix}-color-palette`),this.change=(()=>{});const n=t.h("table","").children(t.h("tbody","").children(t.h("tr",`${e.cssPrefix}-theme-color-placeholders`).children(...s.map(t=>l.call(this,t))),...i.map(s=>t.h("tr",`${e.cssPrefix}-theme-colors`).children(...s.map(t=>l.call(this,t)))),t.h("tr",`${e.cssPrefix}-standard-colors`).children(...r.map(t=>l.call(this,t)))));this.el.child(n)}}}),t("skylark-xspreadsheet/component/dropdown_color",["./dropdown","./icon","./color_palette"],function(t,e,s){"use strict";return class extends t{constructor(t,i){const r=new e(t).css("height","16px").css("border-bottom",`3px solid ${i}`),l=new s;l.change=(t=>{this.setTitle(t),this.change(t)}),super(r,"auto",!1,"bottom-left",l.el)}setTitle(t){this.title.css("border-color",t),this.hide()}}}),t("skylark-xspreadsheet/component/dropdown_linetype",["./dropdown","./element","./icon","../config"],function(t,e,s,i){"use strict";const r=[["thin",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" style="user-select: none;"></line></svg>'],["medium",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="2" style="user-select: none;"><line x1="0" y1="1.0" x2="50" y2="1.0" stroke-width="2" stroke="black" style="user-select: none;"></line></svg>'],["thick",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="3" style="user-select: none;"><line x1="0" y1="1.5" x2="50" y2="1.5" stroke-width="3" stroke="black" style="user-select: none;"></line></svg>'],["dashed",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" stroke-dasharray="2" style="user-select: none;"></line></svg>'],["dotted",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" stroke-dasharray="1" style="user-select: none;"></line></svg>']];return class extends t{constructor(t){const l=new s("line-type");let n=0;const o=r.map((s,r)=>e.h("div",`${i.cssPrefix}-item state ${t===s[0]?"checked":""}`).on("click",()=>{o[n].toggle("checked"),o[r].toggle("checked"),n=r,this.hide(),this.change(s)}).child(e.h("div",`${i.cssPrefix}-line-type`).html(s[1])));super(l,"auto",!1,"bottom-left",...o)}}}),t("skylark-xspreadsheet/component/border_palette",["./element","./icon","./dropdown_color","./dropdown_linetype","../config"],function(t,e,s,i,r){"use strict";function l(...e){return t.h("table","").child(t.h("tbody","").children(...e))}function n(s){return t.h("td","").child(t.h("div",`${r.cssPrefix}-border-palette-cell`).child(new e(`border-${s}`)).on("click",()=>{this.mode=s;const{mode:t,style:e,color:i}=this;this.change({mode:t,style:e,color:i})}))}return class{constructor(){this.color="#000",this.style="thin",this.mode="all",this.change=(()=>{}),this.ddColor=new s("line-color",this.color),this.ddColor.change=(t=>{this.color=t}),this.ddType=new i(this.style),this.ddType.change=(([t])=>{this.style=t}),this.el=t.h("div",`${r.cssPrefix}-border-palette`);const e=l(t.h("tr","").children(t.h("td",`${r.cssPrefix}-border-palette-left`).child(l(t.h("tr","").children(...["all","inside","horizontal","vertical","outside"].map(t=>n.call(this,t))),t.h("tr","").children(...["left","top","right","bottom","none"].map(t=>n.call(this,t))))),t.h("td",`${r.cssPrefix}-border-palette-right`).children(t.h("div",`${r.cssPrefix}-toolbar-btn`).child(this.ddColor.el),t.h("div",`${r.cssPrefix}-toolbar-btn`).child(this.ddType.el))));this.el.child(e)}}}),t("skylark-xspreadsheet/component/dropdown_border",["./dropdown","./icon","./border_palette"],function(t,e,s){"use strict";return class extends t{constructor(){const t=new e("border-all"),i=new s;i.change=(t=>{this.change(t),this.hide()}),super(t,"auto",!1,"bottom-left",i.el)}}}),t("skylark-xspreadsheet/component/toolbar/border",["./dropdown_item","../dropdown_border"],function(t,e){"use strict";return class extends t{constructor(){super("border")}dropdown(){return new e}}}),t("skylark-xspreadsheet/component/toolbar/icon_item",["./item","../icon"],function(t,e){"use strict";return class extends t{element(){return super.element().child(new e(this.tag)).on("click",()=>this.change(this.tag))}setState(t){this.el.disabled(t)}}}),t("skylark-xspreadsheet/component/toolbar/clearformat",["./icon_item"],function(t){"use strict";return class extends t{constructor(){super("clearformat")}}}),t("skylark-xspreadsheet/component/toolbar/paintformat",["./toggle_item"],function(t){"use strict";return class extends t{constructor(){super("paintformat")}setState(){}}}),t("skylark-xspreadsheet/component/toolbar/text_color",["./dropdown_item","../dropdown_color"],function(t,e){"use strict";return class extends t{constructor(t){super("color",void 0,t)}dropdown(){const{tag:t,value:s}=this;return new e(t,s)}}}),t("skylark-xspreadsheet/component/toolbar/fill_color",["./dropdown_item","../dropdown_color"],function(t,e){"use strict";return class extends t{constructor(t){super("bgcolor",void 0,t)}dropdown(){const{tag:t,value:s}=this;return new e(t,s)}}}),t("skylark-xspreadsheet/component/dropdown_fontsize",["./dropdown","./element","../core/font","../config"],function(t,e,s,i){"use strict";return class extends t{constructor(){const t=s.fontSizes.map(t=>e.h("div",`${i.cssPrefix}-item`).on("click",()=>{this.setTitle(`${t.pt}`),this.change(t)}).child(`${t.pt}`));super("10","60px",!0,"bottom-left",...t)}}}),t("skylark-xspreadsheet/component/toolbar/font_size",["./dropdown_item","../dropdown_fontsize"],function(t,e){"use strict";return class extends t{constructor(){super("font-size")}getValue(t){return t.pt}dropdown(){return new e}}}),t("skylark-xspreadsheet/component/dropdown_font",["./dropdown","./element","../core/font","../config"],function(t,e,s,i){"use strict";return class extends t{constructor(){const t=s.baseFonts.map(t=>e.h("div",`${i.cssPrefix}-item`).on("click",()=>{this.setTitle(t.title),this.change(t)}).child(t.title));super(s.baseFonts[0].title,"160px",!0,"bottom-left",...t)}}}),t("skylark-xspreadsheet/component/toolbar/font",["./dropdown_item","../dropdown_font"],function(t,e){"use strict";return class extends t{constructor(){super("font-name")}getValue(t){return t.key}dropdown(){return new e}}}),t("skylark-xspreadsheet/component/dropdown_format",["./dropdown","./element","../core/format","../config"],function(t,e,s,i){"use strict";return class extends t{constructor(){let t=s.baseFormats.slice(0);t.splice(2,0,{key:"divider"}),t.splice(8,0,{key:"divider"}),super("Normal","220px",!0,"bottom-left",...t=t.map(t=>{const s=e.h("div",`${i.cssPrefix}-item`);return"divider"===t.key?s.addClass("divider"):(s.child(t.title()).on("click",()=>{this.setTitle(t.title()),this.change(t)}),t.label&&s.child(e.h("div","label").html(t.label))),s}))}setTitle(t){for(let e=0;e<s.baseFormats.length;e+=1)s.baseFormats[e].key===t&&this.title.html(s.baseFormats[e].title());this.hide()}}}),t("skylark-xspreadsheet/component/toolbar/format",["./dropdown_item","../dropdown_format"],function(t,e){"use strict";return class extends t{constructor(){super("format")}getValue(t){return t.key}dropdown(){return new e}}}),t("skylark-xspreadsheet/component/dropdown_formula",["./dropdown","./icon","./element","../core/formula","../config"],function(t,e,s,i,r){"use strict";return class extends t{constructor(){const t=i.baseFormulas.map(t=>s.h("div",`${r.cssPrefix}-item`).on("click",()=>{this.hide(),this.change(t)}).child(t.key));super(new e("formula"),"180px",!0,"bottom-left",...t)}}}),t("skylark-xspreadsheet/component/toolbar/formula",["./dropdown_item","../dropdown_formula"],function(t,e){"use strict";return class extends t{constructor(){super("formula")}getValue(t){return t.key}dropdown(){return new e}}}),t("skylark-xspreadsheet/component/toolbar/freeze",["./toggle_item"],function(t){"use strict";return class extends t{constructor(){super("freeze")}}}),t("skylark-xspreadsheet/component/toolbar/merge",["./toggle_item"],function(t){"use strict";return class extends t{constructor(){super("merge")}setState(t,e){this.el.active(t).disabled(e)}}}),t("skylark-xspreadsheet/component/toolbar/redo",["./icon_item"],function(t){"use strict";return class extends t{constructor(){super("redo","Ctrl+Y")}}}),t("skylark-xspreadsheet/component/toolbar/undo",["./icon_item"],function(t){"use strict";return class extends t{constructor(){super("undo","Ctrl+Z")}}}),t("skylark-xspreadsheet/component/toolbar/print",["./icon_item"],function(t){"use strict";return class extends t{constructor(){super("print","Ctrl+P")}}}),t("skylark-xspreadsheet/component/toolbar/textwrap",["./toggle_item"],function(t){"use strict";return class extends t{constructor(){super("textwrap")}}}),t("skylark-xspreadsheet/component/toolbar/more",["../dropdown","./dropdown_item","../../config","../element","../icon"],function(t,e,s,i,r){"use strict";return class extends e{constructor(){super("more"),this.el.hide()}dropdown(){return new class extends t{constructor(){const t=new r("ellipsis"),e=i.h("div",`${s.cssPrefix}-toolbar-more`);super(t,"auto",!1,"bottom-right",e),this.moreBtns=e,this.contentEl.css("max-width","420px")}}}show(){this.el.show()}hide(){this.el.hide()}}}),t("skylark-xspreadsheet/component/toolbar/index",["./align","./valign","./autofilter","./bold","./italic","./strike","./underline","./border","./clearformat","./paintformat","./text_color","./fill_color","./font_size","./font","./format","./formula","./freeze","./merge","./redo","./undo","./print","./textwrap","./more","../element","../../config","../event"],function(t,e,s,i,r,l,n,o,h,c,a,d,u,f,p,g,m,w,x,b,v,y,k,C,E,$){"use strict";function S(){return C.h("div",`${E.cssPrefix}-toolbar-divider`)}function R(){const{el:t,btns:e,moreEl:s,btns2:i}=this,{moreBtns:r,contentEl:l}=s.dd;t.css("width",`${this.widthFn()-60}px`);const n=t.box();let o=160,h=12;const c=[],a=[];i.forEach(([t,e],s)=>{o+=e,s===i.length-1||o<n.width?c.push(t):(h+=e,a.push(t))}),e.html("").children(...c),r.html("").children(...a),l.css("width",`${h}px`),a.length>0?s.show():s.hide()}return class{constructor(T,D,P=!1){this.data=T,this.change=(()=>{}),this.widthFn=D,this.isHide=P;const z=T.defaultStyle();this.items=[[this.undoEl=new b,this.redoEl=new x,new v,this.paintformatEl=new c,this.clearformatEl=new h],S(),[this.formatEl=new p],S(),[this.fontEl=new f,this.fontSizeEl=new u],S(),[this.boldEl=new i,this.italicEl=new r,this.underlineEl=new n,this.strikeEl=new l,this.textColorEl=new a(z.color)],S(),[this.fillColorEl=new d(z.bgcolor),this.borderEl=new o,this.mergeEl=new w],S(),[this.alignEl=new t(z.align),this.valignEl=new e(z.valign),this.textwrapEl=new y],S(),[this.freezeEl=new m,this.autofilterEl=new s,this.formulaEl=new g,this.moreEl=new k]],this.el=C.h("div",`${E.cssPrefix}-toolbar`),this.btns=C.h("div",`${E.cssPrefix}-toolbar-btns`),this.items.forEach(t=>{Array.isArray(t)?t.forEach(t=>{this.btns.child(t.el),t.change=((...t)=>{this.change(...t)})}):this.btns.child(t.el)}),this.el.child(this.btns),P?this.el.hide():(this.reset(),setTimeout(()=>{(function(){this.btns2=[],this.items.forEach(t=>{if(Array.isArray(t))t.forEach(({el:t})=>{const e=t.box(),{marginLeft:s,marginRight:i}=t.computedStyle();this.btns2.push([t,e.width+parseInt(s,10)+parseInt(i,10)])});else{const e=t.box(),{marginLeft:s,marginRight:i}=t.computedStyle();this.btns2.push([t,e.width+parseInt(s,10)+parseInt(i,10)])}})}).call(this),R.call(this)},0),$.bind(window,"resize",()=>{R.call(this)}))}paintformatActive(){return this.paintformatEl.active()}paintformatToggle(){this.paintformatEl.toggle()}trigger(t){this[`${t}El`].click()}resetData(t){this.data=t,this.reset()}reset(){if(this.isHide)return;const{data:t}=this,e=t.getSelectedCellStyle();this.undoEl.setState(!t.canUndo()),this.redoEl.setState(!t.canRedo()),this.mergeEl.setState(t.canUnmerge(),!t.selector.multiple()),this.autofilterEl.setState(!t.canAutofilter());const{font:s,format:i}=e;this.formatEl.setState(i),this.fontEl.setState(s.name),this.fontSizeEl.setState(s.size),this.boldEl.setState(s.bold),this.italicEl.setState(s.italic),this.underlineEl.setState(e.underline),this.strikeEl.setState(e.strike),this.textColorEl.setState(e.color),this.fillColorEl.setState(e.bgcolor),this.alignEl.setState(e.align),this.valignEl.setState(e.valign),this.textwrapEl.setState(e.textwrap),this.freezeEl.setState(t.freezeIsActive())}}}),t("skylark-xspreadsheet/component/modal",["./element","./icon","../config","./event"],function(t,e,s,i){"use strict";return class{constructor(i,r,l="600px"){this.title=i,this.el=t.h("div",`${s.cssPrefix}-modal`).css("width",l).children(t.h("div",`${s.cssPrefix}-modal-header`).children(new e("close").on("click.stop",()=>this.hide()),this.title),t.h("div",`${s.cssPrefix}-modal-content`).children(...r)).hide()}show(){this.dimmer=t.h("div",`${s.cssPrefix}-dimmer active`),document.body.appendChild(this.dimmer.el);const{width:e,height:r}=this.el.show().box(),{clientHeight:l,clientWidth:n}=document.documentElement;this.el.offset({left:(n-e)/2,top:(l-r)/3}),window.xkeydownEsc=(t=>{27===t.keyCode&&this.hide()}),i.bind(window,"keydown",window.xkeydownEsc)}hide(){this.el.hide(),document.body.removeChild(this.dimmer.el),i.unbind(window,"keydown",window.xkeydownEsc),delete window.xkeydownEsc}}}),t("skylark-xspreadsheet/component/form_input",["./element","../config"],function(t,e){"use strict";return class{constructor(s,i){this.vchange=(()=>{}),this.el=t.h("div",`${e.cssPrefix}-form-input`),this.input=t.h("input","").css("width",s).on("input",t=>this.vchange(t)).attr("placeholder",i),this.el.child(this.input)}focus(){setTimeout(()=>{this.input.el.focus()},10)}hint(t){this.input.attr("placeholder",t)}val(t){return this.input.val(t)}}}),t("skylark-xspreadsheet/component/form_select",["./element","./suggest","../config"],function(t,e,s){"use strict";return class{constructor(i,r,l,n=(t=>t),o=(()=>{})){this.key=i,this.getTitle=n,this.vchange=(()=>{}),this.el=t.h("div",`${s.cssPrefix}-form-select`),this.suggest=new e(r.map(t=>({key:t,title:this.getTitle(t)})),t=>{this.itemClick(t.key),o(t.key),this.vchange(t.key)},l,this.el),this.el.children(this.itemEl=t.h("div","input-text").html(this.getTitle(i)),this.suggest.el).on("click",()=>this.show())}show(){this.suggest.search("")}itemClick(t){this.key=t,this.itemEl.html(this.getTitle(t))}val(t){return void 0!==t?(this.key=t,this.itemEl.html(this.getTitle(t)),this):this.key}}}),t("skylark-xspreadsheet/component/form_field",["./element","../config","../locale/locale"],function(t,e,s){"use strict";const i={number:/(^\d+$)|(^\d+(\.\d{0,4})?$)/,date:/^\d{4}-\d{1,2}-\d{1,2}$/};return class{constructor(s,i,r,l){this.label="",this.rule=i,r&&(this.label=t.h("label","label").css("width",`${l}px`).html(r)),this.tip=t.h("div","tip").child("tip").hide(),this.input=s,this.input.vchange=(()=>this.validate()),this.el=t.h("div",`${e.cssPrefix}-form-field`).children(this.label,s.el,this.tip)}isShow(){return"none"!==this.el.css("display")}show(){this.el.show()}hide(){return this.el.hide(),this}val(t){return this.input.val(t)}hint(t){this.input.hint(t)}validate(){const{input:t,rule:e,tip:r,el:l}=this,n=t.val();if(e.required&&/^\s*$/.test(n))return r.html(s.t("validation.required")),l.addClass("error"),!1;if(e.type||e.pattern){const t=e.pattern||i[e.type];if(!t.test(n))return r.html(s.t("validation.notMatch")),l.addClass("error"),!1}return l.removeClass("error"),!0}}}),t("skylark-xspreadsheet/component/modal_validation",["./modal","./form_input","./form_select","./form_field","./button","../locale/locale","./element","../config"],function(t,e,s,i,r,l,n,o){"use strict";return class extends t{constructor(){const t=new i(new s("cell",["cell"],"100%",t=>l.t(`dataValidation.modeType.${t}`)),{required:!0},`${l.t("dataValidation.range")}:`,100),h=new i(new e("120px","E3 or E3:F12"),{required:!0,pattern:/^([A-Z]{1,2}[1-9]\d*)(:[A-Z]{1,2}[1-9]\d*)?$/}),c=new i(new s("list",["list","number","date","phone","email"],"100%",t=>l.t(`dataValidation.type.${t}`),t=>this.criteriaSelected(t)),{required:!0},`${l.t("dataValidation.criteria")}:`,100),a=new i(new s("be",["be","nbe","eq","neq","lt","lte","gt","gte"],"160px",t=>l.t(`dataValidation.operator.${t}`),t=>this.criteriaOperatorSelected(t)),{required:!0}).hide(),d=new i(new e("70px","10"),{required:!0}).hide(),u=new i(new e("70px","100"),{required:!0,type:"number"}).hide(),f=new i(new e("120px","a,b,m_config"),{required:!0}),p=new i(new e("70px","10"),{required:!0,type:"number"}).hide();super(l.t("contextmenu.validation"),[n.h("div",`${o.cssPrefix}-form-fields`).children(t.el,h.el),n.h("div",`${o.cssPrefix}-form-fields`).children(c.el,a.el,d.el,u.el,p.el,f.el),n.h("div",`${o.cssPrefix}-buttons`).children(new r("cancel").on("click",()=>this.btnClick("cancel")),new r("remove").on("click",()=>this.btnClick("remove")),new r("save","primary").on("click",()=>this.btnClick("save")))]),this.mf=t,this.rf=h,this.cf=c,this.of=a,this.minvf=d,this.maxvf=u,this.vf=p,this.svf=f,this.change=(()=>{})}showVf(t){const e="date"===t?"2018-11-12":"10",{vf:s}=this;s.input.hint(e),s.show()}criteriaSelected(t){const{of:e,minvf:s,maxvf:i,vf:r,svf:l}=this;"date"===t||"number"===t?(e.show(),s.rule.type=t,i.rule.type=t,"date"===t?(s.hint("2018-11-12"),i.hint("2019-11-12")):(s.hint("10"),i.hint("100")),s.show(),i.show(),r.hide(),l.hide()):("list"===t?l.show():l.hide(),r.hide(),e.hide(),s.hide(),i.hide())}criteriaOperatorSelected(t){if(!t)return;const{minvf:e,maxvf:s,vf:i}=this;if("be"===t||"nbe"===t)e.show(),s.show(),i.hide();else{const t=this.cf.val();i.rule.type=t,"date"===t?i.hint("2018-11-12"):i.hint("10"),i.show(),e.hide(),s.hide()}}btnClick(t){if("cancel"===t)this.hide();else if("remove"===t)this.change("remove"),this.hide();else if("save"===t){const t=["mf","rf","cf","of","svf","vf","minvf","maxvf"];for(let e=0;e<t.length;e+=1){const s=this[t[e]];if(s.isShow()&&!s.validate())return}const e=this.mf.val(),s=this.rf.val(),i=this.cf.val(),r=this.of.val();let l=this.svf.val();"number"!==i&&"date"!==i||(l="be"===r||"nbe"===r?[this.minvf.val(),this.maxvf.val()]:this.vf.val()),this.change("save",e,s,{type:i,operator:r,required:!1,value:l}),this.hide()}}setValue(t){if(t){const{mf:e,rf:s,cf:i,of:r,svf:l,vf:n,minvf:o,maxvf:h}=this,{mode:c,ref:a,validator:d}=t,{type:u,operator:f,value:p}=d||{type:"list"};e.val(c||"cell"),s.val(a),i.val(u),r.val(f),Array.isArray(p)?(o.val(p[0]),h.val(p[1])):(l.val(p||""),n.val(p||"")),this.criteriaSelected(u),this.criteriaOperatorSelected(f)}this.show()}}}),t("skylark-xspreadsheet/component/sort_filter",["./element","./button","./event","../config","../locale/locale"],function(t,e,s,i,r){"use strict";function l(e){return t.h("div",`${i.cssPrefix}-item ${e}`)}function n(t){return l("state").child(r.t(`sort.${t}`)).on("click.stop",()=>this.itemClick(t))}function o(){const{filterhEl:t,filterValues:e,values:s}=this;t.html(`${e.length} / ${s.length}`),t.checked(e.length===s.length)}return class{constructor(){this.filterbEl=t.h("div",`${i.cssPrefix}-body`),this.filterhEl=t.h("div",`${i.cssPrefix}-header state`).on("click.stop",()=>this.filterClick(0,"all")),this.el=t.h("div",`${i.cssPrefix}-sort-filter`).children(this.sortAscEl=n.call(this,"asc"),this.sortDescEl=n.call(this,"desc"),l("divider"),t.h("div",`${i.cssPrefix}-filter`).children(this.filterhEl,this.filterbEl),t.h("div",`${i.cssPrefix}-buttons`).children(new e("cancel").on("click",()=>this.btnClick("cancel")),new e("ok","primary").on("click",()=>this.btnClick("ok")))).hide(),this.ci=null,this.sortDesc=null,this.values=null,this.filterValues=[]}btnClick(t){if("ok"===t){const{ci:t,sort:e,filterValues:s}=this;this.ok&&this.ok(t,e,"in",s)}this.hide()}itemClick(t){this.sort=t;const{sortAscEl:e,sortDescEl:s}=this;e.checked("asc"===t),s.checked("desc"===t)}filterClick(e,s){const{filterbEl:i,filterValues:r,values:l}=this,n=i.children();if("all"===s)n.length===r.length?(this.filterValues=[],n.forEach(e=>t.h(e).checked(!1))):(this.filterValues=Array.from(l),n.forEach(e=>t.h(e).checked(!0)));else{const i=t.h(n[e]).toggle("checked");i?r.push(s):r.splice(r.findIndex(t=>t===s),1)}o.call(this)}set(e,s,l,n){this.ci=e;const{sortAscEl:h,sortDescEl:c}=this;null!==n?(this.sort=n.order,h.checked(n.asc()),c.checked(n.desc())):(this.sortDesc=null,h.checked(!1),c.checked(!1)),this.values=Object.keys(s),this.filterValues=l?Array.from(l.value):Object.keys(s),function(e){const{filterbEl:s,filterValues:l}=this;s.html(""),Object.keys(e).forEach((n,o)=>{const h=e[n],c=l.includes(n)?"checked":"";s.child(t.h("div",`${i.cssPrefix}-item state ${c}`).on("click.stop",()=>this.filterClick(o,n)).children(""===n?r.t("filter.empty"):n,t.h("div","label").html(`(${h})`)))})}.call(this,s,l),o.call(this)}setOffset(t){this.el.offset(t).show();let e=1;s.bindClickoutside(this.el,()=>{e<=0&&this.hide(),e-=1})}show(){this.el.show()}hide(){this.el.hide(),s.unbindClickoutside(this.el)}}}),t("skylark-xspreadsheet/component/message",["./element","./icon","../config"],function(t,e,s){"use strict";return{xtoast:function(i,r){const l=t.h("div",`${s.cssPrefix}-toast`),n=t.h("div",`${s.cssPrefix}-dimmer active`);l.children(t.h("div",`${s.cssPrefix}-toast-header`).children(new e("close").on("click.stop",()=>(document.body.removeChild(l.el),void document.body.removeChild(n.el))),i),t.h("div",`${s.cssPrefix}-toast-content`).html(r)),document.body.appendChild(l.el),document.body.appendChild(n.el);const{width:o,height:h}=l.box(),{clientHeight:c,clientWidth:a}=document.documentElement;l.offset({left:(a-o)/2,top:(c-h)/3})}}}),t("skylark-xspreadsheet/component/sheet",["./element","./event","./resizer","./scrollbar","./selector","./editor","./print","./contextmenu","./table","./toolbar/index","./modal_validation","./sort_filter","./message","../config","../core/formula"],function(t,e,s,i,r,l,n,o,h,c,a,d,u,f,p){"use strict";function g(t,e){let s;return(...i)=>{const r=this,l=i;s||(s=setTimeout(()=>{s=null,t.apply(r,l)},e))}}function m(t,e,s,i=!0,r=!1){if(-1===e&&-1===s)return;const{table:l,selector:n,toolbar:o,data:h,contextMenu:c}=this;c.setMode(-1===e||-1===s?"row-col":"range");const a=h.getCell(e,s);t?(n.setEnd(e,s,r),this.trigger("cells-selected",a,n.range)):(n.set(e,s,i),this.trigger("cell-selected",a,e,s)),o.reset(),l.render()}function w(t,e){const{selector:s,data:i}=this,{rows:r,cols:l}=i;let[n,o]=s.indexes;const{eri:h,eci:c}=s.range;t&&([n,o]=s.moveIndexes),"left"===e?o>0&&(o-=1):"right"===e?(c!==o&&(o=c),o<l.len-1&&(o+=1)):"up"===e?n>0&&(n-=1):"down"===e?(h!==n&&(n=h),n<r.len-1&&(n+=1)):"row-first"===e?o=0:"row-last"===e?o=l.len-1:"col-first"===e?n=0:"col-last"===e&&(n=r.len-1),t&&(s.moveIndexes=[n,o]),m.call(this,t,n,o),function(){const{data:t,verticalScrollbar:e,horizontalScrollbar:s}=this,{l:i,t:r,left:l,top:n,width:o,height:h}=t.getSelectedRect(),c=this.getTableOffset();if(Math.abs(l)+o>c.width)s.move({left:i+o-c.width});else{const e=t.freezeTotalWidth();l<e&&s.move({left:i-1-e})}if(Math.abs(n)+h>c.height)e.move({top:r+h-c.height-1});else{const s=t.freezeTotalHeight();n<s&&e.move({top:r-1-s})}}.call(this)}function x(){const{data:t,verticalScrollbar:e}=this,{height:s}=this.getTableOffset(),i=t.exceptRowTotalHeight(0,-1);e.set(s,t.rows.totalHeight()-i)}function b(){const{data:t,horizontalScrollbar:e}=this,{width:s}=this.getTableOffset();t&&e.set(s,t.cols.totalWidth())}function v(){const{tableEl:t,overlayerEl:e,overlayerCEl:s,table:i,toolbar:r,selector:l,el:n}=this,o=this.getTableOffset(),h=this.getRect();t.attr(h),e.offset(h),s.offset(o),n.css("width",`${h.width}px`),x.call(this),b.call(this),function(){const{selector:t,data:e,editor:s}=this,[i,r]=e.freeze;if(i>0||r>0){const t=e.freezeTotalWidth(),i=e.freezeTotalHeight();s.setFreezeLengths(t,i)}t.resetAreaOffset()}.call(this),i.render(),r.reset(),l.reset()}function y(){const{data:t,selector:e}=this;t.clearClipboard(),e.hideClipboard()}function k(){const{data:t,selector:e}=this;t.copy(),e.showClipboard()}function C(){const{data:t,selector:e}=this;t.cut(),e.showClipboard()}function E(t,e){const{data:s}=this;if("read"!==s.settings.mode)if(s.paste(t,t=>u.xtoast("Tip",t)))v.call(this);else if(e){const t=e.clipboardData.getData("text/plain");this.data.pasteFromText(t),v.call(this)}}function $(t,e){this.data.unhideRowsOrCols(t,e),v.call(this)}function S(t){const{selector:s,data:i,table:r,sortFilter:l}=this,{offsetX:n,offsetY:o}=t,h=t.target.className===`${f.cssPrefix}-selector-corner`,c=i.getCellRectByXY(n,o),{left:a,top:d,width:p,height:g}=c;let{ri:w,ci:x}=c;const{autoFilter:b}=i;if(b.includes(w,x)&&a+p-20<n&&d+g-20<o){const t=b.items(x,(t,e)=>i.rows.getCell(t,e));return l.hide(),l.set(x,t,b.getFilter(x),b.getSort(x)),void l.setOffset({left:a,top:d+g+2})}t.shiftKey||(h?s.showAutofill(w,x):m.call(this,!1,w,x),e.mouseMoveUp(window,t=>{({ri:w,ci:x}=i.getCellRectByXY(t.offsetX,t.offsetY)),h?s.showAutofill(w,x):1!==t.buttons||t.shiftKey||m.call(this,!0,w,x,!0,!0)},()=>{h&&s.arange&&"read"!==i.settings.mode&&i.autofill(s.arange,"all",t=>u.xtoast("Tip",t))&&r.render(),s.hideAutofill(),function(){const{toolbar:t}=this;t.paintformatActive()&&(E.call(this,"format"),y.call(this),t.paintformatToggle())}.call(this)})),h||1!==t.buttons||t.shiftKey&&m.call(this,!0,w,x)}function R(){const{editor:t,data:e}=this,s=e.getSelectedRect(),i=this.getTableOffset();let r="top";s.top>i.height/2&&(r="bottom"),t.setOffset(s,r)}function T(){const{editor:t,data:e}=this;"read"!==e.settings.mode&&(R.call(this),t.setCell(e.getSelectedCell(),e.getSelectedValidator()),y.call(this))}function D(t,e="finished"){const{data:s,table:i}=this;if("read"===s.settings.mode)return;s.setSelectedCellText(t,e);const{ri:r,ci:l}=s.selector;"finished"===e?i.render():this.trigger("cell-edited",t,r,l)}function P(t){const{data:e}=this;"read"!==e.settings.mode&&("insert-row"===t?e.insert("row"):"delete-row"===t?e.delete("row"):"insert-column"===t?e.insert("column"):"delete-column"===t?e.delete("column"):"delete-cell"===t?e.deleteCell():"delete-cell-format"===t?e.deleteCell("format"):"delete-cell-text"===t?e.deleteCell("text"):"cell-printable"===t?e.setSelectedCellAttr("printable",!0):"cell-non-printable"===t?e.setSelectedCellAttr("printable",!1):"cell-editable"===t?e.setSelectedCellAttr("editable",!0):"cell-non-editable"===t&&e.setSelectedCellAttr("editable",!1),y.call(this),v.call(this))}function z(t,e){const{data:s}=this;if("undo"===t)this.undo();else if("redo"===t)this.redo();else if("print"===t)this.print.preview();else if("paintformat"===t)!0===e?k.call(this):y.call(this);else if("clearformat"===t)P.call(this,"delete-cell-format");else if("link"===t);else if("chart"===t);else if("autofilter"===t)(function(){const{data:t}=this;t.autofilter(),v.call(this)}).call(this);else if("freeze"===t)if(e){const{ri:t,ci:e}=s.selector;this.freeze(t,e)}else this.freeze(0,0);else s.setSelectedCellAttr(t,e),"formula"!==t||s.selector.multiple()||T.call(this),v.call(this)}function _(){const{selector:t,overlayerEl:s,rowResizer:i,colResizer:r,verticalScrollbar:l,horizontalScrollbar:n,editor:o,contextMenu:h,toolbar:c,modalValidation:a,sortFilter:d}=this;s.on("mousemove",t=>{(function(t){if(0!==t.buttons)return;if(t.target.className===`${f.cssPrefix}-resizer-hover`)return;const{offsetX:e,offsetY:s}=t,{rowResizer:i,colResizer:r,tableEl:l,data:n}=this,{rows:o,cols:h}=n;if(e>h.indexWidth&&s>o.height)return i.hide(),void r.hide();const c=l.box(),a=n.getCellRectByXY(t.offsetX,t.offsetY);a.ri>=0&&-1===a.ci?(a.width=h.indexWidth,i.show(a,{width:c.width}),o.isHide(a.ri-1)?i.showUnhide(a.ri):i.hideUnhide()):i.hide();-1===a.ri&&a.ci>=0?(a.height=o.height,r.show(a,{height:c.height}),h.isHide(a.ci-1)?r.showUnhide(a.ci):r.hideUnhide()):r.hide()}).call(this,t)}).on("mousedown",t=>{o.clear(),h.hide(),2===t.buttons?(this.data.xyInSelectedRect(t.offsetX,t.offsetY)?h.setPosition(t.offsetX,t.offsetY):(S.call(this,t),h.setPosition(t.offsetX,t.offsetY)),t.stopPropagation()):2===t.detail?T.call(this):S.call(this,t)}).on("mousewheel.stop",t=>{(function(t){const{verticalScrollbar:e,horizontalScrollbar:s,data:i}=this,{top:r}=e.scroll(),{left:l}=s.scroll(),{rows:n,cols:o}=i,{deltaY:h,deltaX:c}=t,a=(t,e)=>{let s=t,i=0;do{i=e(s),s+=1}while(i<=0);return i},d=t=>{if(t>0){const t=i.scroll.ri+1;if(t<n.len){const s=a(t,t=>n.getHeight(t));e.move({top:r+s-1})}}else{const t=i.scroll.ri-1;if(t>=0){const s=a(t,t=>n.getHeight(t));e.move({top:0===t?0:r-s})}}},u=Math.abs(h),f=Math.abs(c),p=Math.max(u,f);/Firefox/i.test(window.navigator.userAgent)&&g(d(t.detail),50);p===f&&g((t=>{if(t>0){const t=i.scroll.ci+1;if(t<o.len){const e=a(t,t=>o.getWidth(t));s.move({left:l+e-1})}}else{const t=i.scroll.ci-1;if(t>=0){const e=a(t,t=>o.getWidth(t));s.move({left:0===t?0:l-e})}}})(c),50);p===u&&g(d(h),50)}).call(this,t)}).on("mouseout",t=>{const{offsetX:e,offsetY:s}=t;s<=0&&r.hide(),e<=0&&i.hide()}),t.inputChange=(t=>{D.call(this,t,"input"),T.call(this)}),e.bindTouch(s.el,{move:(t,e)=>{(function(t,e){const{verticalScrollbar:s,horizontalScrollbar:i}=this,{top:r}=s.scroll(),{left:l}=i.scroll();"left"===t||"right"===t?i.move({left:l-e}):"up"!==t&&"down"!==t||s.move({top:r-e})}).call(this,t,e)}}),c.change=((t,e)=>z.call(this,t,e)),d.ok=((t,e,s,i)=>(function(t,e,s,i){this.data.setAutoFilter(t,e,s,i),v.call(this)}).call(this,t,e,s,i)),i.finishedFn=((t,e)=>{(function(t,e){const{ri:s}=t,{table:i,selector:r,data:l}=this;l.rows.setHeight(s,e),i.render(),r.resetAreaOffset(),x.call(this),R.call(this)}).call(this,t,e)}),r.finishedFn=((t,e)=>{(function(t,e){const{ci:s}=t,{table:i,selector:r,data:l}=this;l.cols.setWidth(s,e),i.render(),r.resetAreaOffset(),b.call(this),R.call(this)}).call(this,t,e)}),i.unhideFn=(t=>{$.call(this,"row",t)}),r.unhideFn=(t=>{$.call(this,"col",t)}),l.moveFn=((t,e)=>{(function(t){const{data:e,table:s,selector:i}=this;e.scrolly(t,()=>{i.resetBRLAreaOffset(),R.call(this),s.render()})}).call(this,t,e)}),n.moveFn=((t,e)=>{(function(t){const{data:e,table:s,selector:i}=this;e.scrollx(t,()=>{i.resetBRTAreaOffset(),R.call(this),s.render()})}).call(this,t,e)}),o.change=((t,e)=>{D.call(this,e,t)}),a.change=((t,...e)=>{"save"===t?this.data.addValidation(...e):this.data.removeValidation()}),h.itemClick=(t=>{"validation"===t?a.setValue(this.data.getSelectedValidation()):"copy"===t?k.call(this):"cut"===t?C.call(this):"paste"===t?E.call(this,"all"):"paste-value"===t?E.call(this,"text"):"paste-format"===t?E.call(this,"format"):"hide"===t?function(){this.data.hideRowsOrCols(),v.call(this)}.call(this):P.call(this,t)}),e.bind(window,"resize",()=>{this.reload()}),e.bind(window,"click",t=>{this.focusing=s.contains(t.target)}),e.bind(window,"paste",t=>{E.call(this,"all",t),t.preventDefault()}),e.bind(window,"keydown",t=>{if(!this.focusing)return;const e=t.keyCode||t.which,{key:s,ctrlKey:i,shiftKey:r,metaKey:l}=t;if(i||l)switch(e){case 90:this.undo(),t.preventDefault();break;case 89:this.redo(),t.preventDefault();break;case 67:k.call(this),t.preventDefault();break;case 88:C.call(this),t.preventDefault();break;case 85:c.trigger("underline"),t.preventDefault();break;case 86:break;case 37:w.call(this,r,"row-first"),t.preventDefault();break;case 38:w.call(this,r,"col-first"),t.preventDefault();break;case 39:w.call(this,r,"row-last"),t.preventDefault();break;case 40:w.call(this,r,"col-last"),t.preventDefault();break;case 32:m.call(this,!1,-1,this.data.selector.ci,!1),t.preventDefault();break;case 66:c.trigger("bold");break;case 73:c.trigger("italic")}else{switch(e){case 32:r&&m.call(this,!1,this.data.selector.ri,-1,!1);break;case 27:h.hide(),y.call(this);break;case 37:w.call(this,r,"left"),t.preventDefault();break;case 38:w.call(this,r,"up"),t.preventDefault();break;case 39:w.call(this,r,"right"),t.preventDefault();break;case 40:w.call(this,r,"down"),t.preventDefault();break;case 9:o.clear(),w.call(this,!1,r?"left":"right"),t.preventDefault();break;case 13:o.clear(),w.call(this,!1,r?"up":"down"),t.preventDefault();break;case 8:P.call(this,"delete-cell-text"),t.preventDefault()}"Delete"===s?(P.call(this,"delete-cell-text"),t.preventDefault()):e>=65&&e<=90||e>=48&&e<=57||e>=96&&e<=105||"="===t.key?(D.call(this,t.key,"input"),T.call(this)):113===e&&T.call(this)}})}return class{constructor(e,u){this.eventMap=new Map;const{view:g,showToolbar:w,showContextmenu:x}=u.settings;this.el=t.h("div",`${f.cssPrefix}-sheet`),this.toolbar=new c(u,g.width,!w),this.print=new n(u),e.children(this.toolbar.el,this.el,this.print.el),this.data=u,this.tableEl=t.h("canvas",`${f.cssPrefix}-table`),this.rowResizer=new s(!1,u.rows.height),this.colResizer=new s(!0,u.cols.minWidth),this.verticalScrollbar=new i(!0),this.horizontalScrollbar=new i(!1),this.editor=new l(p.formulas,()=>this.getTableOffset(),u.rows.height),this.modalValidation=new a,this.contextMenu=new o(()=>this.getRect(),!x),this.selector=new r(u),this.overlayerCEl=t.h("div",`${f.cssPrefix}-overlayer-content`).children(this.editor.el,this.selector.el),this.overlayerEl=t.h("div",`${f.cssPrefix}-overlayer`).child(this.overlayerCEl),this.sortFilter=new d,this.el.children(this.tableEl,this.overlayerEl.el,this.rowResizer.el,this.colResizer.el,this.verticalScrollbar.el,this.horizontalScrollbar.el,this.contextMenu.el,this.modalValidation.el,this.sortFilter.el),this.table=new h.Table(this.tableEl.el,u),_.call(this),v.call(this),m.call(this,!1,0,0)}on(t,e){return this.eventMap.set(t,e),this}trigger(t,...e){const{eventMap:s}=this;s.has(t)&&s.get(t).call(this,...e)}resetData(t){this.editor.clear(),this.data=t,x.call(this),b.call(this),this.toolbar.resetData(t),this.print.resetData(t),this.selector.resetData(t),this.table.resetData(t)}loadData(t){return this.data.setData(t),v.call(this),this}freeze(t,e){const{data:s}=this;return s.setFreeze(t,e),v.call(this),this}undo(){this.data.undo(),v.call(this)}redo(){this.data.redo(),v.call(this)}reload(){return v.call(this),this}getRect(){const{data:t}=this;return{width:t.viewWidth(),height:t.viewHeight()}}getTableOffset(){const{rows:t,cols:e}=this.data,{width:s,height:i}=this.getRect();return{width:s-e.indexWidth,height:i-t.height,left:e.indexWidth,top:t.height}}}}),t("skylark-xspreadsheet/component/bottombar",["./element","./event","../config","./icon","./form_input","./dropdown","./message","../locale/locale"],function(t,e,s,i,r,l,n,o){"use strict";const h=[{key:"delete",title:o.tf("contextmenu.deleteSheet")}];function c(){return h.map(e=>(function(e){return t.h("div",`${s.cssPrefix}-item`).child(e.title()).on("click",()=>{this.itemClick(e.key),this.hide()})}).call(this,e))}return class{constructor(r=(()=>{}),o=(()=>{}),h=(()=>{}),a=(()=>{})){this.swapFunc=o,this.updateFunc=a,this.dataNames=[],this.activeEl=null,this.deleteEl=null,this.items=[],this.moreEl=new class extends l{constructor(t){const e=new i("ellipsis");super(e,"auto",!1,"top-left"),this.contentClick=t}reset(e){const i=e.map((e,i)=>t.h("div",`${s.cssPrefix}-item`).css("width","150px").css("font-weight","normal").on("click",()=>{this.contentClick(i),this.hide()}).child(e));this.setContentChildren(...i)}setTitle(){}}(t=>{this.clickSwap2(this.items[t])}),this.contextMenu=new class{constructor(){this.el=t.h("div",`${s.cssPrefix}-contextmenu`).css("width","160px").children(...c.call(this)).hide(),this.itemClick=(()=>{})}hide(){const{el:t}=this;t.hide(),e.unbindClickoutside(t)}setOffset(t){const{el:s}=this;s.offset(t),s.show(),e.bindClickoutside(s)}},this.contextMenu.itemClick=h,this.el=t.h("div",`${s.cssPrefix}-bottombar`).children(this.contextMenu.el,this.menuEl=t.h("ul",`${s.cssPrefix}-menu`).child(t.h("li","").children(new i("add").on("click",()=>{this.dataNames.length<10?r():n.xtoast("tip","it less than or equal to 10")}),t.h("span","").child(this.moreEl))))}addItem(e,s){this.dataNames.push(e);const i=t.h("li",s?"active":"").child(e);i.on("click",()=>{this.clickSwap2(i)}).on("contextmenu",t=>{const{offsetLeft:e,offsetHeight:s}=t.target;this.contextMenu.setOffset({left:e,bottom:s+1}),this.deleteEl=i}).on("dblclick",()=>{const t=i.html(),e=new r("auto","");e.val(t),e.input.on("blur",({target:e})=>{const{value:s}=e,i=this.dataNames.findIndex(e=>e===t);this.renameItem(i,s)}),i.html("").child(e.el),e.focus()}),s&&this.clickSwap(i),this.items.push(i),this.menuEl.child(i),this.moreEl.reset(this.dataNames)}renameItem(t,e){this.dataNames.splice(t,1,e),this.moreEl.reset(this.dataNames),this.items[t].html("").child(e),this.updateFunc(t,e)}clear(){this.items.forEach(t=>{this.menuEl.removeChild(t.el)}),this.items=[],this.dataNames=[],this.moreEl.reset(this.dataNames)}deleteItem(){const{activeEl:t,deleteEl:e}=this;if(this.items.length>1){const s=this.items.findIndex(t=>t===e);if(this.items.splice(s,1),this.dataNames.splice(s,1),this.menuEl.removeChild(e.el),this.moreEl.reset(this.dataNames),t===e){const[t]=this.items;return this.activeEl=t,this.activeEl.toggle(),[s,0]}return[s,-1]}return[-1]}clickSwap2(t){const e=this.items.findIndex(e=>e===t);this.clickSwap(t),this.activeEl.toggle(),this.swapFunc(e)}clickSwap(t){null!==this.activeEl&&this.activeEl.toggle(),this.activeEl=t}}}),t("skylark-xspreadsheet/spreadsheet",["./component/element","./core/data_proxy","./component/sheet","./component/bottombar","./config","./locale/locale"],function(t,e,s,i,r,l){"use strict";return class{constructor(e,l={}){let n=e;this.options=l,this.sheetIndex=1,this.datas=[],"string"==typeof e&&(n=document.querySelector(e)),this.bottombar=new i(()=>{const t=this.addSheet();this.sheet.resetData(t)},t=>{const e=this.datas[t];this.sheet.resetData(e)},()=>{this.deleteSheet()},(t,e)=>{this.datas[t].name=e}),this.data=this.addSheet();const o=t.h("div",`${r.cssPrefix}`).on("contextmenu",t=>t.preventDefault());n.appendChild(o.el),this.sheet=new s(o,this.data),o.child(this.bottombar.el)}addSheet(t,s=!0){const i=t||`sheet${this.sheetIndex}`,r=new e(i,this.options);return r.change=((...t)=>{this.sheet.trigger("change",...t)}),this.datas.push(r),this.bottombar.addItem(i,s),this.sheetIndex+=1,r}deleteSheet(){const[t,e]=this.bottombar.deleteItem();t>=0&&(this.datas.splice(t,1),e>=0&&this.sheet.resetData(this.datas[e]))}loadData(t){const e=Array.isArray(t)?t:[t];if(this.bottombar.clear(),this.datas=[],e.length>0)for(let t=0;t<e.length;t+=1){const s=e[t],i=this.addSheet(s.name,0===t);i.setData(s),0===t&&this.sheet.resetData(i)}return this}getData(){return this.datas.map(t=>t.getData())}cellText(t,e,s,i=0){return this.datas[i].setCellText(t,e,s,"finished"),this}cell(t,e,s=0){return this.datas[s].getCell(t,e)}cellStyle(t,e,s=0){return this.datas[s].getCellStyle(t,e)}reRender(){return this.sheet.table.render(),this}on(t,e){return this.sheet.on(t,e),this}validate(){const{validations:t}=this.data;return t.errors.size<=0}change(t){return this.sheet.on("change",t),this}static locale(t,e){l.locale(t,e)}}}),t("skylark-xspreadsheet/main",["skylark-langx-ns","./spreadsheet"],function(t,e){return t.attach("intg.xspreadsheet",{Spreadsheet:e,create:(t,s={})=>new e(t,s)})}),t("skylark-xspreadsheet",["skylark-xspreadsheet/main"],function(t){return t})}(s),!i){var n=require("skylark-langx-ns");r?module.exports=n:e.skylarkjs=n}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-xspreadsheet-all.js.map
